import{_ as M,b as z,y as V,R as J,r as d,o as w,c as U,a as y,t as f,e as t,p as a,l as j,f as I,Z as O,$ as W,a0 as Z,a1 as G,S as H,D as K,a2 as Q,E as X,j as F,g as Y,F as x,d as ee,a3 as te,U as _,a4 as oe}from"./index-50b21e1d.js";const k=z.create({baseURL:"https://massagebackend.webenia.org/api",headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!1}),A=V([]);k.interceptors.request.use(e=>{const s=JSON.parse(localStorage.getItem("tokenData"));return s!=null&&s.token&&(e.headers.Authorization=`Bearer ${s.token}`),e},e=>Promise.reject(e));k.interceptors.response.use(e=>e,e=>{var s;return((s=e.response)==null?void 0:s.status)===401&&(localStorage.removeItem("tokenData"),window.location.href="/login"),Promise.reject(e)});const ae=J({name:"CustomersView",components:{Refresh:O,Edit:W,Delete:Z,Plus:G},setup(){const e=H(),s=K(),E=V(null),D=V(!1),R=V([]),C=V(!1),$=V(null),r=localStorage.getItem("lang")||"en",n=Q({name:"",email:"",phone:"",role:"user",country_id:"",password:"",password_confirmation:"",dialing_code:""}),P={1:"93",2:"355",3:"213",4:"376",5:"244",6:"973",7:"880",8:"32",9:"55",10:"1",11:"86",12:"20",13:"33",14:"49",15:"30",16:"91",17:"62",18:"98",19:"964",20:"353",21:"39",22:"81",23:"962",24:"7",25:"254",26:"965",27:"961",28:"218",29:"60",30:"52",31:"212",32:"977",33:"31",34:"64",35:"234",36:"968",37:"92",38:"970",39:"974",40:"7",41:"966",42:"65",43:"27",44:"82",45:"34",46:"249",47:"46",48:"41",49:"963",50:"886",51:"255",52:"66",53:"216",54:"90",55:"256",56:"380",57:"971",58:"44",59:"1",60:"998",61:"84",62:"967",63:"263"},L=async()=>{try{const l=await k.get("/countries");A.value=l.data.data,console.log("Countries loaded:",A.value)}catch(l){console.error("Failed to load countries:",l)}},h={name:[{required:!0,message:r==="en"?"Please enter name":" من فضلك ادخل الاسم",trigger:"blur"},{min:3,message:r==="en"?"Name must be at least 3 characters":"الاسم يجب ان يكون على الاقل 3 حروف",trigger:"blur"}],email:[{required:!0,message:r==="en"?"Please enter email":"من فضلك ادخل البريد الالكتروني",trigger:"blur"},{type:"email",message:r==="en"?"Please enter valid email":" من فضلك ادخل بريد الكتروني صحيح",trigger:"blur"}],phone:[{required:!0,message:r==="en"?"Please enter phone number":"من فضلك ادخل رقم الهاتف",trigger:"blur"},{pattern:/^1[0-9]{9}$/,message:r==="en"?"Enter 10-digit number without country code":" ادخل  10 رقم بدون رمز الدولة",trigger:"blur"}],role:[{required:!0,message:r==="en"?"Please select role":"من فضلك اختر الصلاحية",trigger:"change"}],country_id:[{required:!0,message:r==="en"?"Please select country":"من فضلك اختر الدولة",trigger:"change"}],password:[{required:!0,message:r==="en"?"Please enter password":"من فضلك ادخل كلمة المرور",trigger:"blur"},{min:6,message:r==="en"?"Password must be at least 6 characters":"كلمة المرور يجب ان تكون على الاقل 6 حروف",trigger:"blur"}],password_confirmation:[{required:!0,message:r==="en"?"Please confirm password":"من فضلك ادخل تاكيد كلمة المرور",trigger:"blur"},{validator:(l,u,i)=>{u!==n.password?i(new Error(r==="en"?"Passwords do not match":"كلمات المرور غير متطابقة")):i()},trigger:"blur"}]},p=l=>({admin:"danger",manager:"warning",user:"success"})[l]||"info",v=()=>{D.value=!0,n.name="",n.email="",n.phone="",n.role="user",n.country_id="",n.password="",n.password_confirmation=""},S=async()=>{var l,u,i,m;if(E.value){n.dialing_code=P[n.country_id]||"";try{await E.value.validate(),C.value=!0;const o=await k.post("/users",n);if(o.data.status)_({message:r==="en"?"User created successfully":"تم إنشاء المستخدم بنجاح",type:"success",duration:2e3}),D.value=!1,b();else throw new Error(o.data.message||"Failed to create user")}catch(o){console.error("Error creating user:",(u=(l=o.response)==null?void 0:l.data)==null?void 0:u.message),(m=(i=o.response)==null?void 0:i.data)!=null&&m.message.includes("This email is already taken")?_({message:r==="en"?"This email is already taken":"هذا البريد الالكتروني مستخدم بالفعل",type:"error",duration:5e3}):_({message:r==="en"?"Failed to create user":"فشل في إنشاء المستخدم",type:"error",duration:5e3})}finally{C.value=!1}}},N=l=>{n.dialing_code=P[l]||""},b=async()=>{var l,u,i,m,o;try{C.value=!0,$.value=null;const c=JSON.parse(localStorage.getItem("tokenData"));if(!(c!=null&&c.token)){console.error("No token found"),s.push("/login");return}await e.dispatch("fetchCustomers"),R.value=e.getters.getCustomers}catch(c){console.error("Error loading customers:",c),console.error("Error details:",{message:c.message,response:(l=c.response)==null?void 0:l.data,status:(u=c.response)==null?void 0:u.status}),$.value=((m=(i=c.response)==null?void 0:i.data)==null?void 0:m.message)||c.message||"Failed to load customers",((o=c.response)==null?void 0:o.status)===401&&(localStorage.removeItem("tokenData"),s.push("/login"))}finally{C.value=!1}},q=async l=>{var u,i;try{const m=await k.put(`/users/${l.id}`,l);if(m.data.status)_({message:"User updated successfully",type:"success",duration:2e3}),b();else throw new Error(m.data.message||"Failed to update user")}catch(m){console.error("Error updating user:",m),_({message:r==="en"?((i=(u=m.response)==null?void 0:u.data)==null?void 0:i.message)||"Failed to update user":"فشل في تحديث المستخدم",type:"error",duration:5e3})}},g=async l=>{try{await oe.confirm(r==="en"?`Are you sure you want to delete user ${l.name}?`:`هل أنت متأكد من حذف المستخدم ${l.name}?`,r==="en"?"Warning":"تحذير",{confirmButtonText:r==="en"?"Delete":"حذف",cancelButtonText:r==="en"?"Cancel":"إلغاء",type:"warning"});const u=await k.delete(`/users/${l.id}`);if(u.data.status)_({message:r==="en"?"User deleted successfully":"تم حذف المستخدم بنجاح",type:"success",duration:2e3}),b();else throw new Error(u.data.message||"Failed to delete user")}catch(u){u!=="cancel"&&(console.error("Error deleting user:",u),_({message:r==="en"?"Failed to delete user":"فشل في حذف المستخدم",type:"error",duration:5e3}))}},B=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",T=()=>{$.value=null};return X(()=>{b(),L()}),{usersList:R,isLoading:C,error:$,loadCustomers:b,handleEdit:q,handleDelete:g,formatDate:B,clearError:T,createDialogVisible:D,createForm:n,createRules:h,createFormRef:E,showCreateDialog:v,handleCreate:S,getRoleType:p,countries:A,getCountryCode:N}}}),se={class:"page-container"},re={class:"page-header"},le={class:"page-title"},ne={class:"button-group"},ue={class:"form-footer"},de={key:1,class:"card"},ie={key:2,class:"table-container"},me={class:"button-group"};function ce(e,s,E,D,R,C){const $=d("Plus"),r=d("el-icon"),n=d("el-button"),P=d("Refresh"),L=d("el-alert"),h=d("el-input"),p=d("el-form-item"),v=d("el-option"),S=d("el-select"),N=d("el-form"),b=d("el-dialog"),q=d("el-skeleton"),g=d("el-table-column"),B=d("el-tag"),T=d("Edit"),l=d("el-tooltip"),u=d("Delete"),i=d("el-table"),m=d("el-empty");return w(),U("div",se,[y("div",re,[y("h2",le,f(e.$t("customers.title")),1),y("div",ne,[t(n,{type:"success",class:"action-button",onClick:e.showCreateDialog},{default:a(()=>[t(r,null,{default:a(()=>[t($)]),_:1}),y("span",null,f(e.$t("customers.addCustomer")),1)]),_:1},8,["onClick"]),t(n,{type:"primary",class:"action-button",onClick:e.loadCustomers},{default:a(()=>[t(r,null,{default:a(()=>[t(P)]),_:1}),y("span",null,f(e.$t("customers.refrech")),1)]),_:1},8,["onClick"])])]),e.error?(w(),j(L,{key:0,title:e.error,type:"error","show-icon":"",onClose:e.clearError,class:"mb-md"},null,8,["title","onClose"])):I("",!0),t(b,{modelValue:e.createDialogVisible,"onUpdate:modelValue":s[8]||(s[8]=o=>e.createDialogVisible=o),title:e.$t("customers.addCustomer"),width:"500px"},{footer:a(()=>[y("div",ue,[t(n,{onClick:s[7]||(s[7]=o=>e.createDialogVisible=!1)},{default:a(()=>[F(f(e.$t("customers.cancel")),1)]),_:1}),t(n,{type:"primary",loading:e.isLoading,onClick:e.handleCreate},{default:a(()=>[F(f(e.$t("customers.create")),1)]),_:1},8,["loading","onClick"])])]),default:a(()=>[t(N,{ref:"createFormRef",model:e.createForm,rules:e.createRules,"label-width":"120px",class:"form-container",onSubmit:Y(e.handleCreate,["prevent"])},{default:a(()=>[t(p,{label:e.$t("customers.name"),prop:"name"},{default:a(()=>[t(h,{modelValue:e.createForm.name,"onUpdate:modelValue":s[0]||(s[0]=o=>e.createForm.name=o),placeholder:e.$t("customers.Enter-name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.email"),prop:"email"},{default:a(()=>[t(h,{modelValue:e.createForm.email,"onUpdate:modelValue":s[1]||(s[1]=o=>e.createForm.email=o),placeholder:e.$t("customers.Enter-email")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.role"),prop:"role"},{default:a(()=>[t(S,{modelValue:e.createForm.role,"onUpdate:modelValue":s[2]||(s[2]=o=>e.createForm.role=o),placeholder:e.$t("customers.Enter-role")},{default:a(()=>[t(v,{label:e.$t("customers.admin"),value:"admin"},null,8,["label"]),t(v,{label:e.$t("customers.user"),value:"user"},null,8,["label"]),t(v,{label:e.$t("customers.manager"),value:"manager"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.country"),prop:"country_id"},{default:a(()=>[t(S,{modelValue:e.createForm.country_id,"onUpdate:modelValue":s[3]||(s[3]=o=>e.createForm.country_id=o),placeholder:e.$t("customers.Enter-address"),onChange:e.getCountryCode},{default:a(()=>[(w(!0),U(x,null,ee(e.countries,o=>(w(),j(v,{key:o.id,label:o.name_en,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","onChange"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.phone"),prop:"phone"},{default:a(()=>[t(h,{modelValue:e.createForm.phone,"onUpdate:modelValue":s[4]||(s[4]=o=>e.createForm.phone=o),style:{"max-width":"600px"},placeholder:e.$t("customers.Enter-phone")},te({_:2},[e.createForm.dialing_code?{name:"prepend",fn:a(()=>[F("+"+f(e.createForm.dialing_code),1)]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.password"),prop:"password"},{default:a(()=>[t(h,{modelValue:e.createForm.password,"onUpdate:modelValue":s[5]||(s[5]=o=>e.createForm.password=o),type:"password",placeholder:e.$t("customers.Enter-password"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.confirmPassword"),prop:"password_confirmation"},{default:a(()=>[t(h,{modelValue:e.createForm.password_confirmation,"onUpdate:modelValue":s[6]||(s[6]=o=>e.createForm.password_confirmation=o),type:"password",placeholder:e.$t("customers.Enter-comfirmPassword"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules","onSubmit"])]),_:1},8,["modelValue","title"]),e.isLoading?(w(),U("div",de,[t(q,{rows:5,animated:""})])):(w(),U("div",ie,[t(i,{data:e.usersList,style:{width:"100%"},border:!0},{default:a(()=>[t(g,{prop:"id",label:e.$t("customers.customer-id"),width:"80"},null,8,["label"]),t(g,{prop:"name",label:e.$t("customers.name"),"min-width":"120"},null,8,["label"]),t(g,{prop:"email",label:e.$t("customers.email"),"min-width":"180"},null,8,["label"]),t(g,{prop:"phone",label:e.$t("customers.phone"),"min-width":"120"},null,8,["label"]),t(g,{prop:"role",label:e.$t("customers.role"),width:"120"},{default:a(o=>[t(B,{type:e.getRoleType(o.row.role),class:"status-tag"},{default:a(()=>[F(f(o.row.role),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(g,{prop:"created_at",label:e.$t("customers.Created-At"),width:"150"},{default:a(o=>[F(f(e.formatDate(o.row.created_at)),1)]),_:1},8,["label"]),t(g,{label:e.$t("customers.actions"),width:"150",fixed:"right"},{default:a(o=>[y("div",me,[t(l,{content:e.$t("customers.editCustomer"),placement:"top"},{default:a(()=>[t(n,{type:"primary",size:"small",class:"action-button",onClick:c=>e.handleEdit(o.row)},{default:a(()=>[t(r,null,{default:a(()=>[t(T)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),t(l,{content:e.$t("customers.deleteCustomer"),placement:"top"},{default:a(()=>[t(n,{type:"danger",size:"small",class:"action-button",onClick:c=>e.handleDelete(o.row)},{default:a(()=>[t(r,null,{default:a(()=>[t(u)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data"]),!e.isLoading&&e.usersList.length===0?(w(),j(m,{key:0,description:"No users found"})):I("",!0)]))])}const ge=M(ae,[["render",ce]]);export{ge as default};
