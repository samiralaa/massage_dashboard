import{_ as Q,h as X,e as V,d as Y,r as u,o as g,c as E,a as _,t as b,m as P,w as s,i as D,b as t,v as Z,x,y as ee,z as te,u as oe,s as re,A as ae,B as U,f as se,j as S,F as le,k as ne,C as ue,l as ie,E as h,D as de}from"./index-8e378a69.js";const F=X.create({baseURL:"https://backend.msgperfumes.com/api",headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!1}),G=V([]);F.interceptors.request.use(e=>{const o=JSON.parse(localStorage.getItem("tokenData"));return o!=null&&o.token&&(e.headers.Authorization=`Bearer ${o.token}`),e},e=>Promise.reject(e));F.interceptors.response.use(e=>e,e=>{var o;return((o=e.response)==null?void 0:o.status)===401&&(localStorage.removeItem("tokenData"),window.location.href="/login"),Promise.reject(e)});const me=Y({name:"CustomersView",components:{Refresh:Z,Edit:x,Delete:ee,Plus:te},setup(){const e=oe(),o=re(),L=V(null),T=V(!1),B=V([]),v=V(!1),$=V(null),a=localStorage.getItem("lang")||"en",n=ae({name:"",email:"",phone:"",role:"user",country_id:"",password:"",password_confirmation:"",dialing_code:""}),R={1:"93",2:"355",3:"213",4:"376",5:"244",6:"973",7:"880",8:"32",9:"55",10:"1",11:"86",12:"20",13:"33",14:"49",15:"30",16:"91",17:"62",18:"98",19:"964",20:"353",21:"39",22:"81",23:"962",24:"7",25:"254",26:"965",27:"961",28:"218",29:"60",30:"52",31:"212",32:"977",33:"31",34:"64",35:"234",36:"968",37:"92",38:"970",39:"974",40:"7",41:"966",42:"65",43:"27",44:"82",45:"34",46:"249",47:"46",48:"41",49:"963",50:"886",51:"255",52:"66",53:"216",54:"90",55:"256",56:"380",57:"971",58:"44",59:"1",60:"998",61:"84",62:"967",63:"263"},q=async()=>{try{const l=await F.get("/countries");G.value=l.data.data,console.log("Countries loaded:",G.value)}catch(l){console.error("Failed to load countries:",l)}},w={name:[{required:!0,message:a==="en"?"Please enter name":" من فضلك ادخل الاسم",trigger:"blur"},{min:3,message:a==="en"?"Name must be at least 3 characters":"الاسم يجب ان يكون على الاقل 3 حروف",trigger:"blur"}],email:[{required:!0,message:a==="en"?"Please enter email":"من فضلك ادخل البريد الالكتروني",trigger:"blur"},{type:"email",message:a==="en"?"Please enter valid email":" من فضلك ادخل بريد الكتروني صحيح",trigger:"blur"}],phone:[{required:!0,message:a==="en"?"Please enter phone number":"من فضلك ادخل رقم الهاتف",trigger:"blur"},{pattern:/^1[0-9]{9}$/,message:a==="en"?"Enter 10-digit number without country code":" ادخل  10 رقم بدون رمز الدولة",trigger:"blur"}],role:[{required:!0,message:a==="en"?"Please select role":"من فضلك اختر الصلاحية",trigger:"change"}],country_id:[{required:!0,message:a==="en"?"Please select country":"من فضلك اختر الدولة",trigger:"change"}],password:[{required:!0,message:a==="en"?"Please enter password":"من فضلك ادخل كلمة المرور",trigger:"blur"},{min:6,message:a==="en"?"Password must be at least 6 characters":"كلمة المرور يجب ان تكون على الاقل 6 حروف",trigger:"blur"}],password_confirmation:[{required:!0,message:a==="en"?"Please confirm password":"من فضلك ادخل تاكيد كلمة المرور",trigger:"blur"},{validator:(l,i,m)=>{i!==n.password?m(new Error(a==="en"?"Passwords do not match":"كلمات المرور غير متطابقة")):m()},trigger:"blur"}]},f=l=>({admin:"danger",manager:"warning",user:"success"})[l]||"info",C=U(()=>e.getters.getUser||e.getters.getProfile||{}),k=U(()=>C.value&&C.value.role==="manager"),M=()=>{if(!k.value){h({message:a==="en"?"Only managers can create users":"إنشاء المستخدمين مسموح للمدير فقط",type:"warning",duration:3e3});return}T.value=!0,n.name="",n.email="",n.phone="",n.role="user",n.country_id="",n.password="",n.password_confirmation=""},A=async()=>{var l,i,m,c;if(!k.value){h({message:a==="en"?"Only managers can create users":"إنشاء المستخدمين مسموح للمدير فقط",type:"error",duration:3e3});return}if(L.value){n.dialing_code=R[n.country_id]||"";try{await L.value.validate(),v.value=!0;const y=await F.post("/users",n);if(y.data.status)h({message:a==="en"?"User created successfully":"تم إنشاء المستخدم بنجاح",type:"success",duration:2e3}),T.value=!1,d();else throw new Error(y.data.message||"Failed to create user")}catch(y){console.error("Error creating user:",(i=(l=y.response)==null?void 0:l.data)==null?void 0:i.message),(c=(m=y.response)==null?void 0:m.data)!=null&&c.message.includes("This email is already taken")?h({message:a==="en"?"This email is already taken":"هذا البريد الالكتروني مستخدم بالفعل",type:"error",duration:5e3}):h({message:a==="en"?"Failed to create user":"فشل في إنشاء المستخدم",type:"error",duration:5e3})}finally{v.value=!1}}},j=l=>{n.dialing_code=R[l]||""},d=async(l=1)=>{var i,m,c,y,K;try{v.value=!0,$.value=null;const p=JSON.parse(localStorage.getItem("tokenData"));if(!(p!=null&&p.token)){console.error("No token found"),o.push("/login");return}await e.dispatch("fetchCustomers",l),B.value=e.getters.getCustomers}catch(p){console.error("Error loading customers:",p),console.error("Error details:",{message:p.message,response:(i=p.response)==null?void 0:i.data,status:(m=p.response)==null?void 0:m.status}),$.value=((y=(c=p.response)==null?void 0:c.data)==null?void 0:y.message)||p.message||"Failed to load customers",((K=p.response)==null?void 0:K.status)===401&&(localStorage.removeItem("tokenData"),o.push("/login"))}finally{v.value=!1}},I=async l=>{var i,m;try{const c=await F.put(`/users/${l.id}`,l);if(c.data.status)h({message:"User updated successfully",type:"success",duration:2e3}),d();else throw new Error(c.data.message||"Failed to update user")}catch(c){console.error("Error updating user:",c),h({message:a==="en"?((m=(i=c.response)==null?void 0:i.data)==null?void 0:m.message)||"Failed to update user":"فشل في تحديث المستخدم",type:"error",duration:5e3})}},N=async l=>{try{await de.confirm(a==="en"?`Are you sure you want to delete user ${l.name}?`:`هل أنت متأكد من حذف المستخدم ${l.name}?`,a==="en"?"Warning":"تحذير",{confirmButtonText:a==="en"?"Delete":"حذف",cancelButtonText:a==="en"?"Cancel":"إلغاء",type:"warning"});const i=await F.delete(`/users/${l.id}`);if(i.data.status)h({message:a==="en"?"User deleted successfully":"تم حذف المستخدم بنجاح",type:"success",duration:2e3}),d();else throw new Error(i.data.message||"Failed to delete user")}catch(i){i!=="cancel"&&(console.error("Error deleting user:",i),h({message:a==="en"?"Failed to delete user":"فشل في حذف المستخدم",type:"error",duration:5e3}))}},z=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",O=()=>{$.value=null},J=U(()=>e.getters.getCustomersCurrentPage),W=U(()=>e.getters.getCustomersLastPage),r=U(()=>e.getters.getCustomersTotal),H=l=>{d(l)};return se(()=>{d(),q()}),{isManager:k,usersList:B,isLoading:v,error:$,loadCustomers:d,handleEdit:I,handleDelete:N,formatDate:z,clearError:O,createDialogVisible:T,createForm:n,createRules:w,createFormRef:L,showCreateDialog:M,handleCreate:A,getRoleType:f,countries:G,getCountryCode:j,customersCurrentPage:J,customersLastPage:W,customersTotal:r,handlePageChange:H}}}),ce={class:"page-container"},pe={class:"page-header"},ge={class:"page-title"},fe={class:"button-group"},he={class:"form-footer"},ye={key:2,class:"card"},be={key:3,class:"table-container"},we={class:"button-group"},Ce={key:1,class:"pagination-container"};function _e(e,o,L,T,B,v){const $=u("Plus"),a=u("el-icon"),n=u("el-button"),R=u("Refresh"),q=u("el-alert"),w=u("el-input"),f=u("el-form-item"),C=u("el-option"),k=u("el-select"),M=u("el-form"),A=u("el-dialog"),j=u("el-skeleton"),d=u("el-table-column"),I=u("el-tag"),N=u("el-tooltip"),z=u("Delete"),O=u("el-table"),J=u("el-empty"),W=u("el-pagination");return g(),E("div",ce,[_("div",pe,[_("h2",ge,b(e.$t("customers.title")),1),_("div",fe,[e.isManager?(g(),P(n,{key:0,type:"success",class:"action-button",onClick:e.showCreateDialog},{default:s(()=>[t(a,null,{default:s(()=>[t($)]),_:1}),_("span",null,b(e.$t("customers.addCustomer")),1)]),_:1},8,["onClick"])):D("",!0),t(n,{type:"primary",class:"action-button",onClick:e.loadCustomers},{default:s(()=>[t(a,null,{default:s(()=>[t(R)]),_:1}),_("span",null,b(e.$t("customers.refrech")),1)]),_:1},8,["onClick"])])]),e.error?(g(),P(q,{key:0,title:e.error,type:"error","show-icon":"",onClose:e.clearError,class:"mb-md"},null,8,["title","onClose"])):D("",!0),e.isManager?(g(),P(A,{key:1,modelValue:e.createDialogVisible,"onUpdate:modelValue":o[8]||(o[8]=r=>e.createDialogVisible=r),title:e.$t("customers.addCustomer"),width:"500px"},{footer:s(()=>[_("div",he,[t(n,{onClick:o[7]||(o[7]=r=>e.createDialogVisible=!1)},{default:s(()=>[S(b(e.$t("customers.cancel")),1)]),_:1}),t(n,{type:"primary",loading:e.isLoading,onClick:e.handleCreate},{default:s(()=>[S(b(e.$t("customers.create")),1)]),_:1},8,["loading","onClick"])])]),default:s(()=>[t(M,{ref:"createFormRef",model:e.createForm,rules:e.createRules,"label-width":"120px",class:"form-container",onSubmit:ie(e.handleCreate,["prevent"])},{default:s(()=>[t(f,{label:e.$t("customers.name"),prop:"name"},{default:s(()=>[t(w,{modelValue:e.createForm.name,"onUpdate:modelValue":o[0]||(o[0]=r=>e.createForm.name=r),placeholder:e.$t("customers.Enter-name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:e.$t("customers.email"),prop:"email"},{default:s(()=>[t(w,{modelValue:e.createForm.email,"onUpdate:modelValue":o[1]||(o[1]=r=>e.createForm.email=r),placeholder:e.$t("customers.Enter-email")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:e.$t("customers.role"),prop:"role"},{default:s(()=>[t(k,{modelValue:e.createForm.role,"onUpdate:modelValue":o[2]||(o[2]=r=>e.createForm.role=r),placeholder:e.$t("customers.Enter-role")},{default:s(()=>[t(C,{label:e.$t("customers.admin"),value:"admin"},null,8,["label"]),t(C,{label:e.$t("customers.user"),value:"user"},null,8,["label"]),t(C,{label:e.$t("customers.manager"),value:"manager"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:e.$t("customers.country"),prop:"country_id"},{default:s(()=>[t(k,{modelValue:e.createForm.country_id,"onUpdate:modelValue":o[3]||(o[3]=r=>e.createForm.country_id=r),placeholder:e.$t("customers.Enter-address"),onChange:e.getCountryCode},{default:s(()=>[(g(!0),E(le,null,ne(e.countries,r=>(g(),P(C,{key:r.id,label:r.name_en,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","onChange"])]),_:1},8,["label"]),t(f,{label:e.$t("customers.phone"),prop:"phone"},{default:s(()=>[t(w,{modelValue:e.createForm.phone,"onUpdate:modelValue":o[4]||(o[4]=r=>e.createForm.phone=r),style:{"max-width":"600px"},placeholder:e.$t("customers.Enter-phone")},ue({_:2},[e.createForm.dialing_code?{name:"prepend",fn:s(()=>[S("+"+b(e.createForm.dialing_code),1)]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:e.$t("customers.password"),prop:"password"},{default:s(()=>[t(w,{modelValue:e.createForm.password,"onUpdate:modelValue":o[5]||(o[5]=r=>e.createForm.password=r),type:"password",placeholder:e.$t("customers.Enter-password"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:e.$t("customers.confirmPassword"),prop:"password_confirmation"},{default:s(()=>[t(w,{modelValue:e.createForm.password_confirmation,"onUpdate:modelValue":o[6]||(o[6]=r=>e.createForm.password_confirmation=r),type:"password",placeholder:e.$t("customers.Enter-comfirmPassword"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules","onSubmit"])]),_:1},8,["modelValue","title"])):D("",!0),e.isLoading?(g(),E("div",ye,[t(j,{rows:5,animated:""})])):(g(),E("div",be,[t(O,{data:e.usersList,style:{width:"100%"},border:!0},{default:s(()=>[t(d,{prop:"id",label:e.$t("customers.customer-id"),width:"80"},null,8,["label"]),t(d,{prop:"name",label:e.$t("customers.name"),"min-width":"120"},null,8,["label"]),t(d,{prop:"email",label:e.$t("customers.email"),"min-width":"180"},null,8,["label"]),t(d,{prop:"phone",label:e.$t("customers.phone"),"min-width":"120"},null,8,["label"]),t(d,{prop:"role",label:e.$t("customers.role"),width:"120"},{default:s(r=>[t(I,{type:e.getRoleType(r.row.role),class:"status-tag"},{default:s(()=>[S(b(r.row.role),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(d,{prop:"created_at",label:e.$t("customers.Created-At"),width:"150"},{default:s(r=>[S(b(e.formatDate(r.row.created_at)),1)]),_:1},8,["label"]),t(d,{label:e.$t("customers.actions"),width:"150",fixed:"right"},{default:s(r=>[_("div",we,[t(N,{content:e.$t("customers.editCustomer"),placement:"top"},null,8,["content"]),t(N,{content:e.$t("customers.deleteCustomer"),placement:"top"},{default:s(()=>[t(n,{type:"danger",size:"small",class:"action-button",onClick:H=>e.handleDelete(r.row)},{default:s(()=>[t(a,null,{default:s(()=>[t(z)]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data"]),!e.isLoading&&e.usersList.length===0?(g(),P(J,{key:0,description:"No users found"})):D("",!0),e.customersTotal>0?(g(),E("div",Ce,[t(W,{background:"",layout:"prev, pager, next",total:e.customersTotal,"page-size":15,"current-page":e.customersCurrentPage,onCurrentChange:e.handlePageChange},null,8,["total","current-page","onCurrentChange"])])):D("",!0)]))])}const $e=Q(me,[["render",_e]]);export{$e as default};
