import{_ as ae,D as te,M as ue,y as k,L as oe,N as ne,E as re,r as v,o as d,c as s,e as u,p as n,b as c,a as q,t as P,F as f,d as D,j as U,l as _,f as y,U as F}from"./index-50b21e1d.js";const de={class:"product-edit-container"},ie={key:1,class:"amount-entry mb-3"},se={key:5,class:"image-preview-list",style:{"margin-bottom":"1em"}},ce=["src"],pe={class:"el-upload__text"},V="https://massagebackend.webenia.org",me={__name:"Edit",setup(ve){const T=te(),L=ue(),A=k(null),E=L.params.id,e=k({name_en:"",name_ar:"",price:"",is_available:1,description_en:"",description_ar:"",category_ar:"",category_en:"",category_id:null,currency_id:null,country_id:null,parent_id:null,brand_id:null,images:[],amount_required:!1,amounts:[],unit_id:null,weight:null,amount_price:null,discount:{id:null,value:null,startDate:null,endDate:null,is_active:!1}}),O=()=>{e.value.amounts.push({unit_id:null,weight:null,price:null})},W=a=>{if(e.value.amounts.length<=1){F.warning(localStorage.getItem("lang")==="ar"?"يجب عليك حفظ كمية واحدة على الاقل":"At least one amount entry is required.");return}if(confirm(localStorage.getItem("lang")==="ar"?"سيتم حذف الكمية":"The amount will be deleted"))e.value.amounts.splice(a,1);else return},j={name_en:[{required:!0,message:"Required",trigger:"blur"}],price:[{required:!0,message:"Required",trigger:"blur"}],"discount.endDate":[{required:!0,message:"Required",trigger:"blur"}],"discount.startDate":[{required:!0,message:"Required",trigger:"blur"}]},h=k([]),C=k([]),I=k([]),N=k([]),Y=k([]),R=k([]),z=a=>(localStorage.getItem("lang")||"en")==="ar"?a.name_ar:a.name_en,J=oe(()=>C.value.filter(a=>!a.is_deleted)),M=a=>a?typeof a=="object"&&a.url?a.url:a.startsWith("http")?a:`${V}/public/storage/${a}`:"",G=async()=>{var $;const a=($=JSON.parse(localStorage.getItem("tokenData")))==null?void 0:$.token;c.defaults.headers.common.Authorization=`Bearer ${a}`;const[t,p,r,o,i,b]=await Promise.all([c.get(`${V}/api/brands/${e.value.brand_id}/categories`),c.get(`${V}/api/currencies`),c.get(`${V}/api/countries`),c.get(`${V}/api/products`),c.get(`${V}/api/brands`),c.get(`${V}/api/units`)]);h.value=t.data.data,console.log("Categories:",h.value),C.value=p.data,I.value=r.data.data,N.value=o.data.data,Y.value=i.data.data,R.value=b.data.data},H=async()=>{var a,t,p;try{const o=(await c.get(`/api/products/${E}`)).data.data;console.log(o),e.value.name_ar=o.name_ar,e.value.name_en=o.name_en,e.value.description_ar=o.description_ar,e.value.description_en=o.description_en,e.value.price=o.price,e.value.category_ar=o.category.name_ar,e.value.category_en=o.category.name_en,e.value.currency_id=o.currency_id,e.value.country_id=o.country_id,e.value.brand_id=o.brand_id,e.value.parent_id=o.parent_id,e.value.quantity=o.quantity??1,e.value.amounts=((a=o.amounts)==null?void 0:a.map(m=>({unit_id:m.unit_id,weight:m.weight,price:m.price,id:m.id})))||[],e.value.type=o.type??"product",e.value.offer=o.discount?"1":"0",e.value.offer_price=o.discount?o.discounted_price:"",e.value.category_id=o.category_id,e.value.images=o.images.map(m=>({id:m.id,path:m.path,url:M(m.path)})),e.value.discount=o.discount?{id:o.discount.id,value:parseFloat(o.discount.discount_value),startDate:(t=o.discount.start_date)==null?void 0:t.split("T")[0],endDate:(p=o.discount.end_date)==null?void 0:p.split("T")[0],is_active:o.discount.is_active}:{id:null,value:null,startDate:null,endDate:null,is_active:!1};const[i,b,$]=await Promise.all([c.get("/api/categories"),c.get("/api/currencies"),c.get("/api/brands")]);h.value=i.data.data,C.value=b.data,Y.value=$.data.data}catch(r){console.error("Error loading product data",r)}},K=(a,t)=>e.value.images=t,Q=(a,t)=>e.value.images=t,X=()=>{A.value.validate(async a=>{var r;if(!a)return;const t=new FormData;for(const o in e.value)o!=="images"&&e.value[o]!==null&&t.append(o,e.value[o]);e.value.amounts.forEach((o,i)=>{t.append(`amounts[${i}][unit_id]`,o.unit_id),t.append(`amounts[${i}][weight]`,o.weight),t.append(`amounts[${i}][price]`,o.price),o.id&&t.append(`amounts[${i}][id]`,o.id)}),e.value.images.forEach(o=>{o.raw?t.append("images[]",o.raw):o.id&&t.append("existing_images[]",o.id)}),e.value.discount.value&&(t.append("discount[value]",e.value.discount.value),t.append("discount[startDate]",e.value.discount.startDate),t.append("discount[endDate]",e.value.discount.endDate),e.value.discount.id&&t.append("discount[id]",e.value.discount.id));const p=(r=JSON.parse(localStorage.getItem("tokenData")))==null?void 0:r.token;c.defaults.headers.common.Authorization=`Bearer ${p}`,await c.post(`${V}/api/products/${E}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}),F.success("Product updated successfully"),T.push("/products")})},Z=()=>{confirm(localStorage.getItem("lang")==="ar"?"سيتم حذف الخصم":"The discount will be deleted")&&(e.value.discount={id:null,value:null,startDate:null,endDate:null,is_active:!1})};return ne(()=>e.value.brand_id,async a=>{if(a)try{const t=await c.get(`${V}/api/brands/${a}/categories`);h.value=t.data.data,console.log("Categories for brand:",h.value)}catch(t){console.error("Failed to fetch categories for brand",t)}else{const t=await c.get(`${V}/api/categories`);h.value=t.data.data,e.value.category_id=null}}),re(async()=>{await H(),G()}),(a,t)=>{const p=v("el-input"),r=v("el-form-item"),o=v("el-divider"),i=v("el-option"),b=v("el-select"),$=v("el-button"),m=v("el-switch"),S=v("el-input-number"),B=v("el-date-picker"),x=v("el-upload"),ee=v("el-form"),le=v("el-card");return d(),s("div",de,[u(le,{class:"product-card"},{default:n(()=>[q("h2",null,P(a.$t("Products.EditProduct")),1),u(ee,{model:e.value,ref_key:"formRef",ref:A,rules:j,"label-width":"120px",enctype:"multipart/form-data"},{default:n(()=>[u(r,{label:a.$t("Products.NameEn"),prop:"name_en"},{default:n(()=>[u(p,{modelValue:e.value.name_en,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.name_en=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.NameAr"),prop:"name_ar"},{default:n(()=>[u(p,{modelValue:e.value.name_ar,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.name_ar=l)},null,8,["modelValue"])]),_:1},8,["label"]),e.value.amounts?(d(!0),s(f,{key:0},D(e.value.amounts,(l,w)=>(d(),s("div",{key:w,class:"amount-entry mb-3"},[u(o,{"content-position":"left"},{default:n(()=>[U(P(a.$t("Products.Amount-Info")),1)]),_:1}),u(r,{label:a.$t("Products.Unit"),prop:`amounts.${w}.unit_id`},{default:n(()=>[u(b,{modelValue:l.unit_id,"onUpdate:modelValue":g=>l.unit_id=g,placeholder:a.$t("Products.select-unit"),filterable:"",clearable:""},{default:n(()=>[(d(!0),s(f,null,D(R.value,g=>(d(),_(i,{key:g.id,label:g.name_en,value:g.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]),u(r,{label:a.$t("Products.Weight"),prop:`amounts.${w}.weight`},{default:n(()=>[u(p,{modelValue:l.weight,"onUpdate:modelValue":g=>l.weight=g,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]),u(r,{label:a.$t("Products.amount-Price"),prop:`amounts.${w}.price`},{default:n(()=>[u(p,{modelValue:l.price,"onUpdate:modelValue":g=>l.price=g,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]),e.value.amounts.length>0?(d(),_($,{key:0,type:"danger",onClick:g=>W(w),icon:"el-icon-delete"},{default:n(()=>[U(P(a.$t("Products.RemoveAmount")),1)]),_:2},1032,["onClick"])):y("",!0),e.value.amounts.length>0?(d(),_($,{key:1,type:"success",plain:"",onClick:O,icon:"el-icon-plus"},{default:n(()=>[U(P(a.$t("Products.AddAmount")),1)]),_:1})):y("",!0)]))),128)):y("",!0),u(r,{label:a.$t("Products.discount"),prop:"discount.value"},{default:n(()=>[u(m,{modelValue:e.value.discount.is_active,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.discount.is_active=l),"active-text":"Yes","inactive-text":"No"},null,8,["modelValue"])]),_:1},8,["label"]),e.value.discount&&e.value.discount.is_active?(d(),s("div",ie,[u(o,{"content-position":"left"},{default:n(()=>[U(P(a.$t("Products.discountInfo")),1)]),_:1}),e.value.discount.is_active?(d(),s(f,{key:0},[u(r,{label:a.$t("Products.Discount-Value"),prop:"discount.value"},{default:n(()=>[u(S,{modelValue:e.value.discount.value,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.discount.value=l),type:"number",min:1,max:99},null,8,["modelValue"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.Start-Date"),prop:"discount.startDate"},{default:n(()=>[u(B,{modelValue:e.value.discount.startDate,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.discount.startDate=l),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"Pick start date",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.End-Date"),prop:"discount.endDate"},{default:n(()=>[u(B,{modelValue:e.value.discount.endDate,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.discount.endDate=l),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"Pick end date",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"]),e.value.discount.value?(d(),_($,{key:0,type:"danger",icon:"el-icon-delete",onClick:Z},{default:n(()=>[U(P(a.$t("Products.removeDiscount")),1)]),_:1})):y("",!0),u(o)],64)):y("",!0)])):y("",!0),!e.value.amounts.length>0?(d(),_(r,{key:2,label:a.$t("Products.Needs-Amount")},{default:n(()=>[u(m,{modelValue:e.value.amount_required,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.amount_required=l),"active-text":"Yes","inactive-text":"No",dir:"ltr",class:"mx-3"},null,8,["modelValue"])]),_:1},8,["label"])):y("",!0),e.value.amount_required?(d(),s(f,{key:3},[u(o,{"content-position":"left"},{default:n(()=>[U(P(a.$t("Products.Amount-Info")),1)]),_:1}),u(r,{label:a.$t("Products.Unit"),prop:"unit_id"},{default:n(()=>[u(b,{modelValue:e.value.unit_id,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.unit_id=l),placeholder:a.$t("Products.select-unit"),filterable:"",clearable:""},{default:n(()=>[(d(!0),s(f,null,D(R.value,l=>(d(),_(i,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.Weight"),prop:"weight"},{default:n(()=>[u(S,{modelValue:e.value.weight,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.weight=l),type:"number",min:1,placeholder:a.$t("Products.select-weight")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.amount-Price"),prop:"amount_price"},{default:n(()=>[u(S,{modelValue:e.value.amount_price,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.amount_price=l),type:"number",min:1,placeholder:a.$t("Products.select-price")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):y("",!0),e.value.amounts?y("",!0):(d(),_(r,{key:4,label:a.$t("Products.Price"),prop:"price"},{default:n(()=>[u(p,{modelValue:e.value.price,"onUpdate:modelValue":t[10]||(t[10]=l=>e.value.price=l),type:"number"},null,8,["modelValue"])]),_:1},8,["label"])),u(r,{label:a.$t("Products.Availability"),prop:"is_available"},{default:n(()=>[u(m,{modelValue:e.value.is_available,"onUpdate:modelValue":t[11]||(t[11]=l=>e.value.is_available=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.DescriptionEn"),prop:"description_en"},{default:n(()=>[u(p,{type:"textarea",modelValue:e.value.description_en,"onUpdate:modelValue":t[12]||(t[12]=l=>e.value.description_en=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.DescriptionAr"),prop:"description_ar"},{default:n(()=>[u(p,{type:"textarea",modelValue:e.value.description_ar,"onUpdate:modelValue":t[13]||(t[13]=l=>e.value.description_ar=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.brand"),prop:"brand_id"},{default:n(()=>[u(b,{modelValue:e.value.brand_id,"onUpdate:modelValue":t[14]||(t[14]=l=>e.value.brand_id=l),filterable:"",clearable:"",placeholder:"Select Brand"},{default:n(()=>[(d(!0),s(f,null,D(Y.value,l=>(d(),_(i,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.Category"),prop:"category_id"},{default:n(()=>[u(b,{modelValue:e.value.category_id,"onUpdate:modelValue":t[15]||(t[15]=l=>e.value.category_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCategory")},{default:n(()=>[(d(!0),s(f,null,D(h.value,l=>(d(),_(i,{key:l.id,label:l.name_en||l.name_ar,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.Currency"),prop:"currency_id"},{default:n(()=>[u(b,{modelValue:e.value.currency_id,"onUpdate:modelValue":t[16]||(t[16]=l=>e.value.currency_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCurrency")},{default:n(()=>[(d(!0),s(f,null,D(J.value,l=>(d(),_(i,{key:l.id,label:z(l),value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.Country"),prop:"country_id"},{default:n(()=>[u(b,{modelValue:e.value.country_id,"onUpdate:modelValue":t[17]||(t[17]=l=>e.value.country_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCountry")},{default:n(()=>[(d(!0),s(f,null,D(I.value,l=>(d(),_(i,{key:l.id,label:l.name_en||l.name_ar,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(r,{label:a.$t("Products.ParentProduct"),prop:"parent_id"},{default:n(()=>[u(b,{modelValue:e.value.parent_id,"onUpdate:modelValue":t[18]||(t[18]=l=>e.value.parent_id=l),clearable:"",placeholder:a.$t("Products.SelectParentProduct")},{default:n(()=>[u(i,{label:a.$t("Products.None"),value:null},null,8,["label"]),(d(!0),s(f,null,D(N.value,l=>(d(),_(i,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e.value.images&&e.value.images.length?(d(),s("div",se,[(d(!0),s(f,null,D(e.value.images,(l,w)=>(d(),s("img",{key:w,src:l.url?l.url:M(l.path),alt:"Product Image",style:{"max-width":"120px","max-height":"120px","margin-right":"10px","border-radius":"8px"}},null,8,ce))),128))])):y("",!0),u(r,{label:a.$t("Products.Images"),prop:"images"},{default:n(()=>[u(x,{class:"upload-demo",drag:"",action:"","auto-upload":!1,limit:5,"file-list":e.value.images,"list-type":"picture","on-change":K,"on-remove":Q},{default:n(()=>[t[19]||(t[19]=q("i",{class:"el-icon-upload"},null,-1)),q("div",pe,P(a.$t("Products.DropFiles")),1)]),_:1,__:[19]},8,["file-list"])]),_:1},8,["label"]),u(r,null,{default:n(()=>[u($,{type:"primary",onClick:X},{default:n(()=>[U(P(a.$t("Products.UpdateButton")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},be=ae(me,[["__scopeId","data-v-eb796aec"]]);export{be as default};
