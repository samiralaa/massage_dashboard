import{_ as w,H as C,b,r as O,o as d,c as a,e as k,a as e,t as r,n as h,g as u,j as p,F as m,d as f,f as D}from"./index-50b21e1d.js";const S={components:{Header:C},name:"UserOrder",data(){return{orders:[],currentFilter:null,selectedOrder:null,isDialogVisible:!1,loading:!0,selectedCurrency:localStorage.getItem("selectedCurrency")?JSON.parse(localStorage.getItem("selectedCurrency")).code:"EGP"}},computed:{allOrdersCount(){return this.orders.length},pendingOrdersCount(){return this.orders.filter(t=>t.status==="pending").length},acceptedOrdersCount(){return this.orders.filter(t=>t.status==="accepted").length},completedOrdersCount(){return this.orders.filter(t=>t.status==="completed").length},cancelledOrdersCount(){return this.orders.filter(t=>t.status==="cancelled").length},filteredOrders(){return this.currentFilter?this.orders.filter(t=>t.status===this.currentFilter):this.orders}},methods:{async fetchOrders(){var t,s,g;try{const i=localStorage.getItem("auth_token");if(!i){this.$toast.error("Please login to view your orders"),this.$router.push("/login");return}const n=await b.get("https://massagebackend.webenia.org/api/orders/user",{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});n.data.status&&n.data.data.original.success?this.orders=n.data.data.original.orders:this.$toast.error(n.data.message||"Failed to fetch orders")}catch(i){console.error("Failed to fetch orders:",i),((t=i.response)==null?void 0:t.status)===401?(this.$toast.error("Please login to view your orders"),this.$router.push("/login")):this.$toast.error(((g=(s=i.response)==null?void 0:s.data)==null?void 0:g.message)||"Failed to fetch orders")}finally{this.loading=!1}},filterOrders(t){this.currentFilter=this.currentFilter===t?null:t},imageUrl(t){return`https://massagebackend.webenia.org/public/storage/${t}`},formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})},formatStatus(t){return{pending:"In Progress",accepted:"Accepted",completed:"Completed",cancelled:"Cancelled"}[t.toLowerCase()]||t},getStatusBadgeClass(t){return{pending:"bg-warning",accepted:"bg-info",completed:"bg-success",cancelled:"bg-danger"}[t.toLowerCase()]||"bg-secondary"},updateCurrency(){const t=localStorage.getItem("selectedCurrency");this.selectedCurrency=t?JSON.parse(t).code:"EGP"},toggleDropdown(t){t.classList.toggle("show")},setupDropdown(){const t=document.getElementById("selectDropdownButton"),s=document.getElementById("selectDropdownContent"),g=document.getElementById("selectedValue"),i=document.getElementById("hiddenSelectValue"),n=s.querySelectorAll(".select-option");t==null||t.addEventListener("click",()=>this.toggleDropdown(s)),n.forEach(o=>{o.addEventListener("click",v=>{v.preventDefault(),g.textContent=o.textContent,i.value=o.getAttribute("data-value"),s.classList.remove("show")})}),window.addEventListener("click",o=>{!t.contains(o.target)&&s.classList.contains("show")&&s.classList.remove("show")}),window.addEventListener("keydown",o=>{o.key==="Escape"&&s.classList.contains("show")&&s.classList.remove("show")})},async showOrderDetailsPopup(t){var s,g;this.isDialogVisible=!0,this.loading=!0;try{const i=localStorage.getItem("auth_token"),n=await b.get(`https://massagebackend.webenia.org/api/orders/${t}`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});n.data.status&&n.data.data.original.success?this.selectedOrder=n.data.data.original.orders.find(o=>o.id===t):this.$toast.error(n.data.message||"Failed to fetch order details")}catch(i){console.error("Failed to fetch order details:",i),this.$toast.error(((g=(s=i.response)==null?void 0:s.data)==null?void 0:g.message)||"Failed to fetch order details")}finally{this.loading=!1}}},mounted(){this.fetchOrders(),this.setupDropdown(),window.addEventListener("currency-changed",this.updateCurrency)},beforeUnmount(){window.removeEventListener("currency-changed",this.updateCurrency)}},F={class:"container py-4"},I={class:"mb-4 fw-bold"},L={class:"orders-header"},x={class:"num"},B={class:"num"},E={class:"num"},V={class:"num"},j={class:"num"},N={class:"dropdown-container"},P={id:"selectDropdownButton",type:"button",class:"select-dropdown-button"},A={id:"selectedValue",class:"selected-value"},U={id:"selectDropdownContent",class:"select-dropdown-content"},z={style:{"padding-top":"0.25rem","padding-bottom":"0.25rem"},role:"menu","aria-orientation":"vertical","aria-labelledby":"selectDropdownButton"},H={class:"num"},M={class:"num"},T={class:"num"},q={class:"num"},G={class:"num"},J={key:0,class:"text-center"},$={key:1,class:"row g-4"},K={class:"order-card p-4 rounded-4 shadow-sm bg-white"},Q={class:"d-flex justify-content-between align-items-start flex-wrap mb-3"},R={class:"text-muted"},W={class:"fw-bold"},X={class:"text-end"},Y={class:"text-muted"},Z={class:"items row gy-3 overflow-auto mb-3 pb-2 border-bottom"},ee=["src"],te={key:1,src:"https://via.placeholder.com/150",class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"},alt:"No Image Available"},se={class:"small"},re={class:"text-muted",dir:"ltr"},oe={class:"d-flex justify-content-between align-items-center"},le=["onClick"],ne={key:2,class:"alert alert-info text-center"},de={key:0,class:"modal-overlay d-flex justify-content-center align-items-center"},ae={class:"cart-modal bg-white rounded-4 shadow p-4 position-relative"},ie={class:"mb-3"},ce={key:0,class:"text-center"},ue={key:1,class:"cart-content"},ge={class:"mb-3"},he={class:"row flex-wrap gap-2 align-items-start border-bottom flex justify-content-center py-3 px-2",style:{"max-height":"70vh","overflow-y":"auto"}},pe={class:"card h-100 border-0 shadow-sm rounded-3"},me=["src"],ve={key:1,src:"https://via.placeholder.com/300x300?text=No+Image",class:"card-img-top rounded-top",style:{"aspect-ratio":"1 / 1","object-fit":"cover"},alt:"No Image Available"},fe={class:"card-body d-flex flex-column"},_e={class:"card-title small mb-1"},ye={class:"text-muted",dir:"ltr"};function be(t,s,g,i,n,o){const v=O("Header");return d(),a(m,null,[k(v),e("div",F,[e("h2",I,r(t.$t("orders.myOrders")),1),e("div",L,[e("a",{class:h(["order-stage",{active:!n.currentFilter}]),href:"#",onClick:s[0]||(s[0]=u(l=>o.filterOrders(null),["prevent"]))},[e("h3",null,r(t.$t("orders.allOrders")),1),e("h3",x,r(o.allOrdersCount),1)],2),e("a",{class:h(["order-stage",{active:n.currentFilter==="accepted"}]),href:"#",onClick:s[1]||(s[1]=u(l=>o.filterOrders("accepted"),["prevent"]))},[e("h3",null,r(t.$t("orders.accepted")),1),e("h3",B,r(o.acceptedOrdersCount),1)],2),e("a",{class:h(["order-stage",{active:n.currentFilter==="pending"}]),href:"#",onClick:s[2]||(s[2]=u(l=>o.filterOrders("pending"),["prevent"]))},[e("h3",null,r(t.$t("orders.inProgress")),1),e("h3",E,r(o.pendingOrdersCount),1)],2),e("a",{class:h(["order-stage",{active:n.currentFilter==="completed"}]),href:"#",onClick:s[3]||(s[3]=u(l=>o.filterOrders("completed"),["prevent"]))},[e("h3",null,r(t.$t("orders.completed")),1),e("h3",V,r(o.completedOrdersCount),1)],2),e("a",{class:h(["order-stage",{active:n.currentFilter==="cancelled"}]),href:"#",onClick:s[4]||(s[4]=u(l=>o.filterOrders("cancelled"),["prevent"]))},[e("h3",null,r(t.$t("orders.cancelled")),1),e("h3",j,r(o.cancelledOrdersCount),1)],2)]),e("div",N,[e("button",P,[e("span",A,r(t.$t("orders.allOrders")),1),s[11]||(s[11]=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))]),e("div",U,[e("div",z,[e("a",{class:"select-option",href:"#",onClick:s[5]||(s[5]=u(l=>o.filterOrders(null),["prevent"]))},[p(r(t.$t("orders.allOrders"))+" ",1),e("h3",H,r(o.allOrdersCount),1)]),e("a",{class:"select-option",href:"#",onClick:s[6]||(s[6]=u(l=>o.filterOrders("accepted"),["prevent"]))},[p(r(t.$t("orders.accepted"))+" ",1),e("h3",M,r(o.acceptedOrdersCount),1)]),e("a",{class:"select-option",href:"#",onClick:s[7]||(s[7]=u(l=>o.filterOrders("pending"),["prevent"]))},[p(r(t.$t("orders.inProgress"))+" ",1),e("h3",T,r(o.pendingOrdersCount),1)]),e("a",{class:"select-option",href:"#",onClick:s[8]||(s[8]=u(l=>o.filterOrders("completed"),["prevent"]))},[p(r(t.$t("orders.completed"))+" ",1),e("h3",q,r(o.completedOrdersCount),1)]),e("a",{class:"select-option",href:"#",onClick:s[9]||(s[9]=u(l=>o.filterOrders("cancelled"),["prevent"]))},[p(r(t.$t("orders.cancelled"))+" ",1),e("h3",G,r(o.cancelledOrdersCount),1)])])]),s[12]||(s[12]=e("input",{type:"hidden",id:"hiddenSelectValue",name:"selectOption",value:""},null,-1))]),n.loading?(d(),a("div",J,s[13]||(s[13]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):o.filteredOrders.length>0?(d(),a("div",$,[(d(!0),a(m,null,f(o.filteredOrders,l=>(d(),a("div",{key:l.id,class:"col-12 col-md-6"},[e("div",K,[e("div",Q,[e("div",null,[e("small",R,r(t.$t("orders.orderId")),1),e("h5",W,"#"+r(l.invoice_number),1)]),e("div",X,[e("small",Y,r(o.formatDate(l.ordered_at)),1),s[14]||(s[14]=e("br",null,null,-1)),e("span",{class:h(["badge",o.getStatusBadgeClass(l.status)])},r(o.formatStatus(l.status)),3)])]),e("div",Z,[(d(!0),a(m,null,f(l.items,c=>(d(),a("div",{key:c.id,class:"d-flex flex-column align-items-start col-4"},[c.product&&c.product.images&&c.product.images.length?(d(),a("img",{key:0,src:o.imageUrl(c.product.images[0].path),class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"}},null,8,ee)):(d(),a("img",te)),e("strong",se,r(t.$i18n.locale=="ar"?c.product.name_ar:c.product.name_en),1),e("small",re,r(c.price)+" "+r(l.currency)+" x"+r(c.quantity),1)]))),128))]),e("div",oe,[e("strong",null,"Total: "+r(l.total_price)+" "+r(l.currency)+" ("+r(l.items.length)+" Items)",1),e("button",{class:"btn btn-outline-dark btn-sm",onClick:c=>o.showOrderDetailsPopup(l.id)},r(t.$t("orders.details")),9,le)])])]))),128))])):(d(),a("div",ne,r(t.$t("orders.noOrder")),1))]),n.isDialogVisible?(d(),a("div",de,[e("div",ae,[e("button",{type:"button",class:"btn-close position-absolute top-0 end-0 m-3",onClick:s[10]||(s[10]=l=>n.isDialogVisible=!1),"aria-label":"Close"}),e("h4",ie,r(t.$t("orders.orderDetails")),1),n.loading?(d(),a("div",ce,s[15]||(s[15]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):(d(),a("div",ue,[e("div",ge,[s[16]||(s[16]=e("strong",null,"Status:",-1)),e("span",{class:h(["badge",o.getStatusBadgeClass(n.selectedOrder.status)])},r(o.formatStatus(n.selectedOrder.status)),3)]),e("div",he,[(d(!0),a(m,null,f(n.selectedOrder.items,l=>{var c,_,y;return d(),a("div",{key:l.id,class:"col-12 col-md-4 col-lg-3"},[e("div",pe,[(_=(c=l.product)==null?void 0:c.images)!=null&&_.length?(d(),a("img",{key:0,src:o.imageUrl(l.product.images[0].path),class:"card-img-top rounded-top",style:{"aspect-ratio":"1 / 1","object-fit":"cover"},alt:"Product Image"},null,8,me)):(d(),a("img",ve)),e("div",fe,[e("strong",_e,r(((y=l.product)==null?void 0:y.name_en)||"No Name"),1),e("small",ye,r(l.price)+" "+r(n.selectedCurrency)+" Ã— "+r(l.quantity),1)])])])}),128))])]))])])):D("",!0)],64)}const Ce=w(S,[["render",be],["__scopeId","data-v-4e100126"]]);export{Ce as default};
