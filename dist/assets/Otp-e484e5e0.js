import{_ as f,b as m,r as _,o as u,c as h,a as n,m as v,t as d,g,F as y,d as k,i as w,f as I,e as b,j as S,w as M,v as O}from"./index-50b21e1d.js";const T="https://massagebackend.webenia.org/api",V={data(){return{otp:Array(4).fill(""),user:null,token:null,timer:"03:00",countdown:null,otpMessage:""}},computed:{otpMessageColor(){return this.otpMessage==="Invalid OTP"||this.otpMessage==="Resend Invalid"?"red":this.otpMessage==="OTP resent successfully"?"green":"#333"},isOtpComplete(){return this.otp.every(t=>/^\d$/.test(t))}},created(){const t=localStorage.getItem("user"),e=localStorage.getItem("auth_token");if(!t||!e){this.$router.push("/register");return}this.user=JSON.parse(t),this.token=e,this.startTimer(),localStorage.removeItem("user")},methods:{focusNext(t){t<4&&this.otp[t-1]&&this.$el.querySelectorAll(".otp-input")[t].focus()},handleInput(t,e){const i=t.target.value;/^\d$/.test(i)?(this.otp[e-1]=i,e<4&&this.focusNext(e)):this.otp[e-1]=""},handleKeyDown(t,e){t.key==="Backspace"&&!this.otp[e-1]&&e>1&&this.$el.querySelectorAll(".otp-input")[e-2].focus()},async handleOtpVerification(){var e,i,p,a;const t=this.otp.join("");try{const s=await m.post("https://massagebackend.webenia.org/api/client/verify-otp",{email:this.user.email,otp:t},{headers:{Authorization:`Bearer ${this.token}`}}),o=s.data.data;o.token&&o.user?(localStorage.setItem("auth_token",o.token),localStorage.setItem("auth_user",JSON.stringify(o.user)),this.$store.commit("auth/SET_AUTH",o),await this.$store.dispatch("cart/loadCart"),this.$router.push("/")):this.otpMessage=s.data.message||"Verification failed."}catch(s){const o=((i=(e=s.response)==null?void 0:e.data)==null?void 0:i.message)||"Invalid OTP";this.otpMessage=o,(a=(p=this.$toast)==null?void 0:p.error)==null||a.call(p,o)}},startTimer(){let t=3,e=0;this.countdown=setInterval(()=>{if(e===0){if(t===0){clearInterval(this.countdown);return}t--,e=59}else e--;this.timer=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},1e3)},async resendOtp(){var t,e,i,p,a,s,o,r;try{const l=await m.post(`${T}/resend-otp`,{email:this.user.email});if(l.data.status===!0){const c=l.data.message||"OTP resent successfully.";this.otpMessage=c,(e=(t=this.$toast)==null?void 0:t.info)==null||e.call(t,c)}else{const c=l.data.message||"Resend Invalid";this.otpMessage=c,(p=(i=this.$toast)==null?void 0:i.error)==null||p.call(i,c)}this.startTimer()}catch(l){const c=((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Resend Invalid";this.otpMessage=c,(r=(o=this.$toast)==null?void 0:o.error)==null||r.call(o,c)}}}},C={class:"otp-wrapper"},N={class:"otp-container"},$={class:"otp-message"},A={class:"otp-input-group",dir:"ltr"},D=["onUpdate:modelValue","onInput","onKeydown"],B=["disabled"],P={class:"resend d-flex w-100 justify-content-between align-items-center mt-3"},K={class:"time-left"},R=["disabled"];function U(t,e,i,p,a,s){const o=_("fa");return u(),h("div",C,[n("div",N,[e[2]||(e[2]=n("img",{src:v,alt:"Logo",height:"100"},null,-1)),n("p",$,d(t.$t("otp.message")),1),n("span",null,d(a.user.email),1),n("form",{onSubmit:e[0]||(e[0]=g((...r)=>s.handleOtpVerification&&s.handleOtpVerification(...r),["prevent"]))},[n("div",A,[(u(),h(y,null,k(4,r=>M(n("input",{key:r,type:"text",inputmode:"numeric",maxlength:"1",pattern:"[0-9]*","onUpdate:modelValue":l=>a.otp[r-1]=l,onInput:l=>s.handleInput(l,r),onKeydown:l=>s.handleKeyDown(l,r),class:"otp-input",placeholder:"_"},null,40,D),[[O,a.otp[r-1]]])),64))]),n("button",{type:"submit",disabled:!s.isOtpComplete,class:"verify-btn"},d(t.$t("otp.verify")),9,B),a.otpMessage?(u(),h("div",{key:0,class:"info-message",style:w({marginTop:"1rem",color:s.otpMessageColor})},d(a.otpMessage),5)):I("",!0)],32),n("div",P,[n("div",K,[n("span",null,d(a.timer),1)]),n("button",{class:"btn btn-link",disabled:a.timer!=="00:00",onClick:e[1]||(e[1]=g((...r)=>s.resendOtp&&s.resendOtp(...r),["prevent"]))},[b(o,{icon:"rotate-right"}),S(" "+d(t.$t("otp.resend")),1)],8,R)])])])}const L=f(V,[["render",U],["__scopeId","data-v-a342f02c"]]);export{L as default};
