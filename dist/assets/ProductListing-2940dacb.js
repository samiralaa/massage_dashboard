import{_ as oe,C as ne,L as R,y as v,z as re,B as le,E as M,ag as ce,N as K,r as O,o as u,c as m,e as f,a,t as d,g as de,n as S,G as L,F as V,d as Y,w as h,v as w,j,f as b,b as E,H as ue,ah as me,p as H,i as ve,I as _}from"./index-50b21e1d.js";const _e={class:"axil-breadcrumb-area mt-5"},ge={class:"container"},pe={class:"row align-items-center"},fe={class:"col-lg-6 col-md-8"},he={class:"inner"},be={class:"title"},ye=["dir"],xe={class:"container"},we={class:"filter col-12"},ke={class:"sidebar-container"},Ce={class:"sidebar-title"},Fe={class:"checkbox-container"},Pe=["value"],Se={class:"sidebar-title"},Le={class:"price-range"},Ve=["min","max"],Ee=["min","max"],Ie={class:"price-values mt-2"},$e={class:"d-flex gap-2 align-items-center"},De=["min","max"],Ue=["min","max"],Te={class:"image-container mb-3 bg-light rounded"},Ae=["src","alt"],Ne={key:0,class:"sale-badge"},qe={class:"product-actions d-flex justify-content-center gap-5 w-100"},ze=["onClick","title"],Be={class:"card-body"},Re={class:"card-title"},Me={class:"price-container"},Ke={key:0,class:"discount-badge"},Oe={key:1,class:"price-old",dir:"ltr"},Ye={class:"card-text card-price",dir:"ltr"},je=["disabled","onClick"],He={__name:"ProductListing",setup(Ge){const{locale:I,t:l}=ne(),G=R(()=>I.value==="ar"?"rtl":"ltr"),$=v([]),D=v([]);v(!1),v("");const p=v([]),i=v({min:0,max:2e3}),r={min:0,max:2e3},g=v(!1),y=re(),U=le(),T=()=>{const e=localStorage.getItem("selectedCurrency");return e?JSON.parse(e).code:"AED"},J=(e,s,o)=>{const c={AED:1,USD:.2724795640326976};return s===o?parseFloat(e):c[o]?parseFloat((e*c[o]).toFixed(2)):parseFloat(e)},k=()=>{g.value=!g.value;const e=document.querySelector(".sidebar"),s=document.body;e&&(g.value?(e.classList.add("active"),s.classList.add("no-scroll")):(e.classList.remove("active"),s.classList.remove("no-scroll")))},Q=e=>`https://massagebackend.webenia.org/public/storage/${e}`,x=e=>y.favorites.some(s=>s.product_id===e),W=e=>{const s=y.favorites.find(o=>o.product_id===e);return s?s.favorite_id||s.id:null},X=async e=>{var s,o,c,t;try{if(x(e.id)){const n=W(e.id);n&&(await y.removeFromFavorites(n),_({title:l("success"),message:l("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const n=await y.addToFavorites(e.id);_({title:l("success"),message:n.message||l("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){if(((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.message)==="Unauthenticated."){_({title:l("error"),message:l("unauthenticated"),type:"warning",duration:4e3});return}_({title:l("error"),message:((t=(c=n.response)==null?void 0:c.data)==null?void 0:t.message)||l("login_required_favorite")||"Login required to favorite product",type:"error"})}},Z=async()=>{try{const e=await E.get("https://massagebackend.webenia.org/api/categories/website/homepage");$.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},A=async()=>{try{const e=await E.get("https://massagebackend.webenia.org/api/list/products");D.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},ee=async e=>{var s,o,c,t;try{let n=0;if(e.discount&&e.discount.is_active){const ie=parseFloat(e.discount.discount_value),B=parseFloat(e.price);n=B-B*(ie/100)}else n=parseFloat(e.price);const P=await E.post("https://massagebackend.webenia.org/api/cart-items",{product_id:e.id,quantity:1,price:n},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});P.data.status?(_({title:l("success"),message:P.data.message,type:"success"}),U.incrementCount(),await U.fetchCartCount()):_({title:l("error"),message:P.data.message,type:"error"})}catch(n){if(((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.message)==="Unauthenticated."){_({title:l("error"),message:l("unauthenticated"),type:"warning",duration:4e3});return}_({title:l("error"),message:(t=(c=n.response)==null?void 0:c.data)==null?void 0:t.message,type:"error"})}},C=v(null),F=v(!1),N=()=>{const e=window.scrollY,s=100;C.value&&(C.value.getBoundingClientRect().top+window.scrollY,F.value=e>=s)};M(()=>{window.addEventListener("scroll",N)}),ce(()=>{window.removeEventListener("scroll",N)}),M(()=>{Z(),A(),window.addEventListener("currency-changed",()=>{A(),se()})});const te=R(()=>D.value.filter(e=>{const s=p.value.length===0||p.value.includes(e.category_id),o=i.value.min===r.min&&i.value.max===r.max,c=J(q(e),e.currency_code||"AED",T.value),t=o?!0:c>=i.value.min&&c<=i.value.max;return s&&t})),se=()=>{p.value=[],i.value.min=r.min,i.value.max=r.max,g.value=!1,document.body.classList.remove("no-scroll")},q=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value),o=parseFloat(e.converted_price||e.price);return(o-o*(s/100)).toFixed(2)}return e.converted_price||e.price},ae=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value);return Math.round(s)}return 0},z=e=>{["e","E","+","-","."].includes(e.key)&&e.preventDefault()};return K(()=>i.value.min,e=>{e>i.value.max&&(i.value.min=i.value.max),e<r.min&&(i.value.min=r.min)}),K(()=>i.value.max,e=>{e<i.value.min&&(i.value.max=i.value.min),e>r.max&&(i.value.max=r.max)}),(e,s)=>{const o=O("router-link"),c=O("fa");return u(),m(V,null,[f(ue),a("div",_e,[a("div",ge,[a("div",pe,[a("div",fe,[a("div",he,[a("h1",be,d(e.$t("products.title")),1)])])])])]),a("div",{class:"shop-container",dir:G.value},[a("div",xe,[a("div",we,[a("a",{href:"#",onClick:de(k,["prevent"])},d(e.$t("products.filter")),1)]),a("aside",{ref_key:"sidebarRef",ref:C,class:S(["sidebar",{active:g.value},{"fixed-sidebar":F.value}])},[a("div",ke,[a("button",{class:"close-btn",onClick:k},"Ã—"),a("h3",Ce,d(L(l)("products.categories")),1),s[7]||(s[7]=a("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(u(!0),m(V,null,Y($.value,t=>(u(),m("div",{key:t.id,class:"filter-item"},[a("label",Fe,[j(d(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),h(a("input",{dir:"ltr",type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=n=>p.value=n),value:t.id},null,8,Pe),[[me,p.value]]),s[5]||(s[5]=a("span",{class:"checkmark"},null,-1))])]))),128)),a("h3",Se,d(L(l)("products.price")),1),s[8]||(s[8]=a("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),a("div",Le,[h(a("input",{type:"range","onUpdate:modelValue":s[1]||(s[1]=t=>i.value.min=t),step:10,min:r.min,max:r.max},null,8,Ve),[[w,i.value.min,void 0,{number:!0}]]),h(a("input",{type:"range","onUpdate:modelValue":s[2]||(s[2]=t=>i.value.max=t),step:10,min:r.min,max:r.max},null,8,Ee),[[w,i.value.max,void 0,{number:!0}]]),a("div",Ie,[a("div",$e,[h(a("input",{dir:"ltr",type:"number","onUpdate:modelValue":s[3]||(s[3]=t=>i.value.min=t),step:10,min:r.min,max:r.max,onKeydown:z,class:"form-control qty-number"},null,40,De),[[w,i.value.min,void 0,{number:!0,lazy:!0}]]),s[6]||(s[6]=a("span",null,"-",-1)),h(a("input",{dir:"ltr",type:"number","onUpdate:modelValue":s[4]||(s[4]=t=>i.value.max=t),step:10,min:r.min,max:r.max,onKeydown:z,class:"form-control qty-number"},null,40,Ue),[[w,i.value.max,void 0,{number:!0,lazy:!0}]]),j(" "+d(T()),1)])])])])],2),g.value?(u(),m("div",{key:0,class:"overlay",onClick:k})):b("",!0),a("section",{class:S(["products-grid",{"ms-300":F.value}])},[(u(!0),m(V,null,Y(te.value,t=>(u(),m("div",{key:t.id,class:"product-card"},[a("div",Te,[f(o,{to:`/read/products/${t.id}`},{default:H(()=>[t.images&&t.images.length?(u(),m("img",{key:0,src:Q(t.images[0].path),alt:t.name},null,8,Ae)):b("",!0)]),_:2},1032,["to"]),t.is_available?b("",!0):(u(),m("div",Ne,d(e.$t("products.outOfStock")),1)),a("div",qe,[f(o,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:H(()=>[f(c,{icon:"eye"})]),_:2},1032,["to"]),a("button",{onClick:n=>X(t),class:S(["btn rounded-circle shadow-sm btn-light",x(t.id)?"text-danger":""]),title:x(t.id)?"Remove from favorites":"Add to favorites"},[f(c,{icon:x(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,ze)])]),a("div",Be,[a("h5",Re,d(L(I)==="ar"?t.name_ar:t.name_en),1),a("div",Me,[t.discount&&t.discount.is_active?(u(),m("span",Ke,d(ae(t))+"% OFF ",1)):b("",!0),t.discount&&t.discount.is_active?(u(),m("span",Oe,d(t.converted_price)+" "+d(t.currency_code),1)):b("",!0),a("span",Ye,d(q(t))+" "+d(t.currency_code),1)])]),a("div",{class:"addToCart-btn",style:ve(t.is_available?"":"cursor: not-allowed;")},[a("button",{disabled:!t.is_available,onClick:n=>ee(t),class:"btn"},d(e.$t("products.addToCart")),9,je)],4)]))),128))],2)])],8,ye)],64)}}},Qe=oe(He,[["__scopeId","data-v-19c16a80"]]);export{Qe as default};
