import{_ as x,C as S,H as E,af as L,b as p,I as w,r as D,o as n,c as l,e as g,a as e,t as i,j as m,g as k,w as c,v as h,f as u,F as b,d as y,h as P}from"./index-50b21e1d.js";const N={setup(){const{t}=S();return{t}},components:{Header:E,fa:L},data(){return{cities:[],countries:[],countryLoading:!1,loading:!0,error:null,user:{},showAddressDialog:!1,editingAddressId:null,addressForm:{building_name:"",floor_number:"",apartment_number:"",postal_code:"",landmark:"",city_id:"",country_id:""},addressSuccess:!1,showResetPasswordModal:!1,password:"",password_confirmation:"",resetPasswordLoading:!1,resetPasswordError:null,resetPasswordSuccess:null,showDeleteDialog:!1,addressToDelete:null,showDeleteSuccess:!1}},methods:{formatDate(t){return t?new Date(t).toLocaleDateString():"N/A"},goToResetPassword(){this.$router.push({name:"ResetPassword",query:{email:this.user.email}})},formatAddress(t){let s="";t.country?s=this.$i18n&&this.$i18n.locale==="ar"?t.country.name_ar:t.country.name_en:t.country_id&&(s=t.country_id);let a="";return t.city?a=this.$i18n&&this.$i18n.locale==="ar"?t.city.name_ar:t.city.name_en:t.city_id&&(a=t.city_id),[t.building_name,t.floor_number,t.apartment_number,t.postal_code,t.landmark,a,s].filter(Boolean).join(", ")},getAddress(t){this.fetchCities(t)},openEditDialog(t=null){t?(this.editingAddressId=t==null?void 0:t.id,this.addressForm={...t},this.showAddressDialog=!0):(this.showAddressDialog=!0,this.addressForm={...t})},closeEditDialog(){this.showAddressDialog=!1,this.editingAddressId=null,this.addressForm={building_name:"",floor_number:"",apartment_number:"",postal_code:"",landmark:"",city_id:"",country_id:""}},async saveAddress(t){if(t==null||t==null){this.addAddress();return}try{const s=await p.post(`api/address/${t}`,this.addressForm,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});w({title:this.$t("success"),message:this.$t("profile.editAddressSuccess"),type:"success"}),await this.fetchUserProfile(),this.closeEditDialog(),this.addressSuccess=!0}catch{w({title:this.$t("error"),message:this.$t("profile.errorEditing"),type:"error"}),this.closeEditDialog()}},async addAddress(){try{const t={user_id:this.user.id,building_name:this.addressForm.building_name,floor_number:this.addressForm.floor_number,apartment_number:this.addressForm.apartment_number,postal_code:this.addressForm.postal_code,landmark:this.addressForm.landmark,city_id:this.addressForm.city_id,country_id:this.addressForm.country_id},s=await p.post("https://massagebackend.webenia.org/api/address",t,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});this.closeEditDialog(),w({title:this.$t("success"),message:this.$t("profile.addSuccess"),type:"success"}),this.fetchUserProfile()}catch(t){throw w({title:this.$t("error"),message:this.$t("profile.errorAdding"),type:"error"}),t}},async resetPassword(){var t,s;if(this.resetPasswordError=null,this.resetPasswordSuccess=null,this.password!==this.password_confirmation){this.resetPasswordError=this.$t("profile.passwordsDoNotMatch");return}if(this.password.length<8){this.resetPasswordError=this.$t("profile.passwordTooShort");return}this.resetPasswordLoading=!0;try{const a=await p.post("api/reset-password",{email:this.user.email,password:this.password,password_confirmation:this.password_confirmation});a.data.status&&a.data.data?(this.resetPasswordSuccess=a.data.message||this.$t("profile.passwordResetSuccess"),setTimeout(()=>{this.showResetPasswordModal=!1,this.password="",this.password_confirmation=""},1500)):this.resetPasswordError=a.data.message||this.$t("profile.passwordResetFailed")}catch(a){this.resetPasswordError=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||this.$t("profile.passwordResetFailed")}finally{this.resetPasswordLoading=!1}},async fetchCountries(){var t;this.countryLoading=!0;try{const s=await p.get("https://massagebackend.webenia.org/api/countries");this.countries=((t=s.data)==null?void 0:t.data)||[]}catch(s){console.error("Error fetching countries:",s)}finally{this.countryLoading=!1}},async fetchCities(t){this.countryLoading=!0;try{const s=await p.get(`https://massagebackend.webenia.org/api/countries/${t}`);this.cities=s.data.data.original.data.cities}catch(s){console.error("Failed to fetch cities:",s),this.cities=[],this.countryLoading=!1}finally{this.countryLoading=!1}},async fetchUserProfile(){var t,s;try{const a=await p.get("api/me",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});this.user=a.data.data.user}catch(a){this.error=((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to fetch profile"}finally{this.loading=!1}},openDeleteDialog(t){this.addressToDelete=t,this.showDeleteDialog=!0},async confirmDeleteAddress(){var t,s,a;if(this.addressToDelete)try{await p.delete(`api/address/${this.addressToDelete.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),this.user.address=this.user.address.filter(f=>f.id!==this.addressToDelete.id),this.showDeleteDialog=!1,this.showDeleteSuccess=!0,this.addressToDelete=null}catch(f){const r=((s=(t=f==null?void 0:f.response)==null?void 0:t.data)==null?void 0:s.message)||this.$t("profile.errorDeletingAddress")||"Failed to delete address";(a=this.$toast)==null||a.error(r),this.showDeleteDialog=!1,this.addressToDelete=null}}},async created(){await this.fetchUserProfile(),await this.fetchCountries(),await this.fetchCities(this.user.country_id)},async mounted(){}},U={class:"profile-outer container my-5"},j={key:0,class:"d-flex flex-column align-items-center justify-content-center py-5"},T={key:1,class:"text-center text-danger"},V={key:2,class:"card p-4 shadow w-75"},B={class:"d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4"},M={class:"d-flex align-items-center gap-3"},R={class:"avatar bg-primary text-white rounded-circle d-flex justify-content-center align-items-center",style:{width:"60px",height:"60px","font-size":"24px"}},I={class:"user-info"},z={class:"mb-0 fw-bold"},q={class:"text-muted"},H={key:0,class:"modal-overlay"},$={class:"modal-dialog-centered"},K={class:"modal-content bg-white p-4 rounded shadow w-100"},O={class:"mb-4"},G={class:"form-group"},J={class:"form-group"},Q={key:0,class:"alert alert-danger"},W={key:1,class:"alert alert-success"},X={class:"d-flex justify-content-end gap-2 mt-2"},Y=["disabled"],Z={key:0,class:"spinner-border spinner-border-sm"},ss={class:"d-flex flex-column gap-3"},es={class:"d-flex justify-content-between border-bottom pb-2"},ts={class:"d-flex justify-content-between align-items-center my-3"},os={class:"mb-0 text-dark"},rs={key:1,class:"mt-4 d-flex justify-content-start flex-wrap gap-4"},is={class:"p-1"},ns={class:"card-title fw-bold mb-2"},ls={class:"mb-1"},as={class:"mb-1"},ds={class:"text-muted"},cs={class:"mb-3"},us={class:"text-muted"},ms={class:"d-flex gap-2"},ps=["onClick"],hs=["onClick"],fs={key:3,class:"modal-overlay"},gs={class:"modal-dialog-centered"},_s={class:"modal-content bg-white p-4 rounded shadow w-100"},ws={class:"form-group"},bs={class:"form-group"},ys={class:"form-group"},vs={class:"form-group"},Ds={class:"form-group"},ks={class:"form-group"},Ps={key:0,disabled:""},As=["value"],Fs={class:"form-group"},Cs={for:"city"},xs=["value"],Ss={class:"d-flex justify-content-end gap-2 mt-2"},Es={type:"submit",class:"btn btn-primary"},Ls={key:0,class:"modal-overlay"},Ns={class:"modal-dialog-centered"},Us={class:"modal-content bg-white p-4 rounded shadow w-100"},js={class:"mb-3"},Ts={class:"d-flex justify-content-end gap-2 mt-2"},Vs={key:1,class:"modal-overlay"},Bs={class:"modal-dialog-centered"},Ms={class:"modal-content bg-white p-4 rounded shadow w-100 text-center"},Rs={class:"mb-3 text-success"};function Is(t,s,a,f,r,d){var v;const A=D("Header"),_=D("fa");return n(),l(b,null,[g(A),e("div",U,[r.loading?(n(),l("div",j,[s[19]||(s[19]=e("span",{class:"loader mb-2"},null,-1)),e("span",null,i(t.$t("profile.loading")),1)])):r.error?(n(),l("div",T,[e("span",null,i(r.error),1)])):(n(),l("div",V,[e("div",B,[e("div",M,[e("div",R,i(r.user.name?r.user.name.charAt(0).toUpperCase():"?"),1),e("div",I,[e("h5",z,i(r.user.name),1),e("small",q,i(r.user.email),1)])]),e("button",{class:"btn btn-outline-secondary d-flex align-items-center gap-1",onClick:s[0]||(s[0]=o=>r.showResetPasswordModal=!0),"aria-label":"Reset Password"},[s[20]||(s[20]=e("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24"},[e("path",{d:"M12 15v2m0 0v2m0-2h2m-2 0H10m8-6a8 8 0 11-16 0 8 8 0 0116 0z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),m(" "+i(t.$t("profile.resetPassword")),1)])]),r.showResetPasswordModal?(n(),l("div",H,[e("div",$,[e("div",K,[e("h5",O,i(t.$t("profile.resetPassword")),1),e("form",{onSubmit:s[4]||(s[4]=k((...o)=>d.resetPassword&&d.resetPassword(...o),["prevent"])),class:"d-flex flex-column gap-3"},[e("div",G,[e("label",null,i(t.$t("profile.newPassword")),1),c(e("input",{type:"password","onUpdate:modelValue":s[1]||(s[1]=o=>r.password=o),class:"form-control",required:""},null,512),[[h,r.password]])]),e("div",J,[e("label",null,i(t.$t("profile.confirmPassword")),1),c(e("input",{type:"password","onUpdate:modelValue":s[2]||(s[2]=o=>r.password_confirmation=o),class:"form-control",required:""},null,512),[[h,r.password_confirmation]])]),r.resetPasswordError?(n(),l("div",Q,i(r.resetPasswordError),1)):u("",!0),r.resetPasswordSuccess?(n(),l("div",W,i(r.resetPasswordSuccess),1)):u("",!0),e("div",X,[e("button",{type:"submit",class:"btn btn-primary",disabled:r.resetPasswordLoading},[r.resetPasswordLoading?(n(),l("span",Z)):u("",!0),m(" "+i(t.$t("profile.submit")),1)],8,Y),e("button",{type:"button",class:"btn btn-secondary",onClick:s[3]||(s[3]=o=>r.showResetPasswordModal=!1)},i(t.$t("profile.cancel")),1)])],32)])])])):u("",!0),e("div",ss,[e("div",es,[e("strong",null,i(t.$t("profile.phone"))+" :",1),e("span",null,i(r.user.phone),1)])]),e("div",ts,[e("h5",os,[g(_,{icon:["fas","map-marker-alt"],class:"me-2 text-primary"}),m(" "+i(t.$t("profile.address")),1)]),e("button",{class:"btn btn-outline-info btn-sm",onClick:s[5]||(s[5]=o=>d.openEditDialog())},[g(_,{icon:["fas","plus"],class:"me-1"}),m(" "+i(t.$t("profile.addAddress")),1)])]),(v=r.user.address)!=null&&v.length?(n(),l("div",rs,[(n(!0),l(b,null,y(r.user.address,(o,F)=>(n(),l("div",{class:"card shadow-sm bg-light p-3 col-12 col-md-5 rounded-3 mx-auto",key:o.id||F},[e("div",is,[e("h6",ns,i(this.$i18n.locale==="ar"?o.country.name_ar:o.country.name_en),1),e("p",ls,i(this.$i18n.locale==="ar"?o.city.name_ar:o.city.name_en),1),e("p",as,[s[21]||(s[21]=e("strong",null,"Postal Code",-1)),s[22]||(s[22]=m()),e("span",ds,i(o.postal_code),1)]),e("p",cs,[s[23]||(s[23]=e("strong",null,"Building Name",-1)),s[24]||(s[24]=m()),e("span",us,i(o.building_name),1)]),e("div",ms,[e("button",{class:"btn btn-outline-danger btn-sm d-flex align-items-center",onClick:C=>d.openDeleteDialog(o)},[g(_,{icon:["fas","fa-trash-alt"],class:"me-2"}),m(" "+i(t.$t("profile.deleteAddress")),1)],8,ps),e("button",{class:"btn btn-outline-dark btn-sm d-flex align-items-center",onClick:C=>{d.openEditDialog(o),d.getAddress(o.country_id)}},[g(_,{icon:["fas","fa-pen"],class:"me-2"}),m(" "+i(t.$t("profile.editAddress")),1)],8,hs)])])]))),128))])):u("",!0)])),r.showAddressDialog?(n(),l("div",fs,[e("div",gs,[e("div",_s,[s[31]||(s[31]=e("h5",{class:"mb-4"},"Edit Address",-1)),e("form",{onSubmit:s[15]||(s[15]=k(o=>d.saveAddress(r.editingAddressId),["prevent"])),class:"d-flex flex-column gap-3"},[e("div",ws,[s[25]||(s[25]=e("label",null,"Building Name",-1)),c(e("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>r.addressForm.building_name=o),class:"form-control",placeholder:"Building Name"},null,512),[[h,r.addressForm.building_name]])]),e("div",bs,[s[26]||(s[26]=e("label",null,"Floor Number",-1)),c(e("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>r.addressForm.floor_number=o),class:"form-control",placeholder:"Floor Number"},null,512),[[h,r.addressForm.floor_number]])]),e("div",ys,[s[27]||(s[27]=e("label",null,"Apartment Number",-1)),c(e("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>r.addressForm.apartment_number=o),class:"form-control",placeholder:"Apartment Number"},null,512),[[h,r.addressForm.apartment_number]])]),e("div",vs,[s[28]||(s[28]=e("label",null,"Postal Code",-1)),c(e("input",{"onUpdate:modelValue":s[9]||(s[9]=o=>r.addressForm.postal_code=o),class:"form-control",placeholder:"Postal Code"},null,512),[[h,r.addressForm.postal_code]])]),e("div",Ds,[s[29]||(s[29]=e("label",null,"Landmark",-1)),c(e("input",{"onUpdate:modelValue":s[10]||(s[10]=o=>r.addressForm.landmark=o),class:"form-control",placeholder:"Landmark"},null,512),[[h,r.addressForm.landmark]])]),e("div",ks,[s[30]||(s[30]=e("label",{for:"country"},"country",-1)),c(e("select",{id:"country",class:"form-control","onUpdate:modelValue":s[11]||(s[11]=o=>r.addressForm.country_id=o),required:"",onChange:s[12]||(s[12]=o=>d.fetchCities(r.addressForm.country_id))},[r.countryLoading?(n(),l("option",Ps,"Loading...")):u("",!0),(n(!0),l(b,null,y(r.countries,o=>(n(),l("option",{key:o.id,value:o.id},i(o.name_en||o.name_ar),9,As))),128))],544),[[P,r.addressForm.country_id]])]),e("div",Fs,[e("label",Cs,i(t.$t("checkout.city")),1),c(e("select",{id:"city",class:"form-select","onUpdate:modelValue":s[13]||(s[13]=o=>r.addressForm.city_id=o),required:""},[(n(!0),l(b,null,y(r.cities,o=>(n(),l("option",{key:o.id,value:o.id,selected:""},i(t.$i18n.locale==="ar"?o.name_ar:o.name_en),9,xs))),128))],512),[[P,r.addressForm.city_id]])]),e("div",Ss,[e("button",Es,i(t.$t("profile.save")),1),e("button",{type:"button",class:"btn btn-secondary",onClick:s[14]||(s[14]=(...o)=>d.closeEditDialog&&d.closeEditDialog(...o))},i(t.$t("profile.cancel")),1)])],32)])])])):u("",!0)]),r.showDeleteDialog?(n(),l("div",Ls,[e("div",Ns,[e("div",Us,[e("h5",js,i(t.$t("profile.confirmDeleteAddress")||"Are you sure you want to delete this address?"),1),e("div",Ts,[e("button",{class:"btn btn-danger",onClick:s[16]||(s[16]=(...o)=>d.confirmDeleteAddress&&d.confirmDeleteAddress(...o))},i(t.$t("profile.deleteAddress")),1),e("button",{class:"btn btn-secondary",onClick:s[17]||(s[17]=o=>r.showDeleteDialog=!1)},i(t.$t("profile.cancel")),1)])])])])):u("",!0),r.showDeleteSuccess?(n(),l("div",Vs,[e("div",Bs,[e("div",Ms,[e("h5",Rs,i(t.$t("profile.addressDeleted")||"Address deleted successfully"),1),e("button",{class:"btn btn-primary",onClick:s[18]||(s[18]=o=>r.showDeleteSuccess=!1)},"OK")])])])):u("",!0)],64)}const qs=x(N,[["render",Is],["__scopeId","data-v-aafcd1ed"]]);export{qs as default};
