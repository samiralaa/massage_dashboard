import{_ as L,X as V,Y as I,b as U,r as D,o as d,c as m,a as o,t as a,g,w,v as P,n as b,f as y,q,e as F,p as k,F as M,d as A,l as S,j}from"./index-50b21e1d.js";const E="https://massagebackend.webenia.org/api",O={name:"Register",components:{ElSelect:V,ElOption:I},data(){return{formData:{fullName:"",email:"",password:"",confirmPassword:"",country_id:"",phoneNumber:""},countryCode:"",phoneNumber:"",errors:{fullName:"",email:"",password:"",confirmPassword:"",phoneNumber:"",country_id:""},countries:[],filteredCountries:[],loading:!1,showPassword:!1,showConfirmPassword:!1,countryCodes:{1:"93",2:"355",3:"213",4:"376",5:"244",6:"973",7:"880",8:"32",9:"55",10:"1",11:"86",12:"20",13:"33",14:"49",15:"30",16:"91",17:"62",18:"98",19:"964",20:"353",21:"39",22:"81",23:"962",24:"7",25:"254",26:"965",27:"961",28:"218",29:"60",30:"52",31:"212",32:"977",33:"31",34:"64",35:"234",36:"968",37:"92",38:"970",39:"974",40:"7",41:"966",42:"65",43:"27",44:"82",45:"34",46:"249",47:"46",48:"41",49:"963",50:"886",51:"255",52:"66",53:"216",54:"90",55:"256",56:"380",57:"971",58:"44",59:"1",60:"998",61:"84",62:"967",63:"263"}}},computed:{selectedCountryDialCode(){if(!Array.isArray(this.countries))return"";const e=this.countries.find(r=>r.id===this.formData.country_id);return e?this.getCountryCode(e.id):""},currentLocale(){var e;return((e=this.$i18n)==null?void 0:e.locale)||"en"}},created(){this.fetchCountries()},watch:{"formData.fullName"(e){this.validateFullName(e)},"formData.email"(e){this.validateEmail(e)},"formData.password"(e){this.validatePassword(e),this.formData.confirmPassword&&this.validateConfirmPassword(this.formData.confirmPassword)},"formData.confirmPassword"(e){this.validateConfirmPassword(e)},"formData.phoneNumber"(e){this.validatePhoneNumber(e)},"formData.country_id":{immediate:!0,handler(e){this.validateCountry(e),e?(this.countryCode=this.getCountryCode(e),this.phoneNumber&&this.updateFullPhoneNumber()):this.countryCode=""}},phoneNumber:{handler(e){this.updateFullPhoneNumber()}}},methods:{getCountryName(e){return this.currentLocale==="ar"?e.name_ar:e.name_en},getCountryCode(e){return this.countryCodes[e]||""},filterCountries(e){if(e){const r=e.toLowerCase();this.filteredCountries=this.countries.filter(n=>{var u,c;const h=((u=n.name_en)==null?void 0:u.toLowerCase())||"",s=((c=n.name_ar)==null?void 0:c.toLowerCase())||"",i=this.getCountryCode(n.id)||"";return h.includes(r)||s.includes(r)||i.includes(r)})}else this.filteredCountries=this.countries},async fetchCountries(){var e,r,n,h;try{this.loading=!0;const i=((e=(await U.get(`${E}/countries`)).data)==null?void 0:e.data)||[];this.countries=Array.isArray(i)?i:[],this.filteredCountries=this.countries,this.formData.country_id&&(this.countryCode=this.getCountryCode(this.formData.country_id),this.updateFullPhoneNumber())}catch(s){console.error("Error fetching countries:",s),(h=(r=this.$toast)==null?void 0:r.error)==null||h.call(r,((n=this.$t)==null?void 0:n.call(this,"register.errorFetchingCountries"))||"Failed to fetch countries")}finally{this.loading=!1}},validateFullName(e){e?e.length<3?this.errors.fullName=this.$t("register.validation.fullNameMinLength"):e.length>255?this.errors.fullName=this.$t("register.validation.fullNameMaxLength"):/^[\p{L}\s'-]+$/u.test(e)?this.errors.fullName="":this.errors.fullName=this.$t("register.validation.fullNameInvalid"):this.errors.fullName=this.$t("register.validation.fullNameRequired")},validateEmail(e){e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?this.errors.email="":this.errors.email=this.$t("register.validation.emailInvalid"):this.errors.email=this.$t("register.validation.emailRequired")},validatePassword(e){e?e.length<8?this.errors.password=this.$t("register.validation.passwordMinLength"):this.errors.password="":this.errors.password=this.$t("register.validation.passwordRequired")},validateConfirmPassword(e){e?e!==this.formData.password?this.errors.confirmPassword=this.$t("register.validation.confirmPasswordMatch"):this.errors.confirmPassword="":this.errors.confirmPassword=this.$t("register.validation.confirmPasswordRequired")},validatePhoneNumber(e){e?this.countryCode?e.length<6||e.length>18?this.errors.phoneNumber=this.$t("register.validation.phoneLength"):/^\d+$/.test(e)?this.errors.phoneNumber="":this.errors.phoneNumber=this.$t("register.validation.phoneInvalid"):this.errors.phoneNumber=this.$t("register.validation.countryRequired"):this.errors.phoneNumber=this.$t("register.validation.phoneRequired")},validateCountry(e){e?this.countries.some(r=>r.id===e)?this.errors.country_id="":this.errors.country_id=this.$t("register.validation.countryInvalid"):this.errors.country_id=this.$t("register.validation.countryRequired")},async handleRegister(){var e,r,n,h,s,i,u,c,C,t,R;if(this.validateFullName(this.formData.fullName),this.validateEmail(this.formData.email),this.validatePassword(this.formData.password),this.validateConfirmPassword(this.formData.confirmPassword),this.validatePhoneNumber(this.formData.phoneNumber),this.validateCountry(this.formData.country_id),!Object.values(this.errors).some(l=>l))try{const l=await U.post(`${E}/clients/register`,{name:this.formData.fullName,email:this.formData.email,password:this.formData.password,password_confirmation:this.formData.confirmPassword,country_id:this.formData.country_id,phone:this.formData.phoneNumber,role:"user",dialing_code:this.selectedCountryDialCode});if(l.data&&l.data.data)localStorage.setItem("user",JSON.stringify(l.data.data.user)),localStorage.setItem("auth_token",l.data.data.token),(r=(e=this.$toast)==null?void 0:e.success)==null||r.call(e,l.data.message||"Registration successful"),this.$router.push("/otp");else throw new Error("Invalid response format")}catch(l){console.error("Registration error:",l);const _={"رقم الهاتف غير صالح لهذا الرمز.":"رقم الهاتف غير صالح لهذا الرمز.","The phone number is not valid for this code.":"رقم الهاتف غير صالح لهذا الرمز."};if((h=(n=l.response)==null?void 0:n.data)!=null&&h.errors){const v=l.response.data.errors;if(Object.keys(v).forEach(f=>{let p=v[f][0];if(f==="phone"){const N=_[p];this.errors.phoneNumber=N?this.$t(N):p}else if(this.errors.hasOwnProperty(f)){const N=_[p];this.errors[f]=N?this.$t(N):p}}),l.response.data.message){const f=l.response.data.message,p=_[f];(i=(s=this.$toast)==null?void 0:s.error)==null||i.call(s,p?this.$t(p):f)}}else{const v=((c=(u=l.response)==null?void 0:u.data)==null?void 0:c.message)||((C=this.$t)==null?void 0:C.call(this,"register.error"))||"Registration failed";(R=(t=this.$toast)==null?void 0:t.error)==null||R.call(t,v)}}},updateFullPhoneNumber(){this.countryCode?this.formData.phoneNumber=this.phoneNumber:this.formData.phoneNumber=this.phoneNumber},formatPhoneNumber(e){let r=e.target.value;r=r.replace(/\D/g,""),this.phoneNumber=r},togglePassword(){this.showPassword=!this.showPassword},toggleConfirmPassword(){this.showConfirmPassword=!this.showConfirmPassword},copyPassword(e){e&&navigator.clipboard.writeText(e).then(()=>{var r,n;(n=(r=this.$toast)==null?void 0:r.success)==null||n.call(r,this.$t("joinUs.passwordCopied")||"Password copied!")}).catch(()=>{var r,n;(n=(r=this.$toast)==null?void 0:r.error)==null||n.call(r,this.$t("joinUs.copyFailed")||"Failed to copy password.")})}}},B={class:"join-us-container"},T={class:"join-us-content"},K={class:"form-header"},H={class:"elegant-title"},z={class:"elegant-description"},J={class:"form-group"},Q={for:"fullName"},X=["placeholder"],Y={key:0,class:"error-message"},G={class:"form-group"},W={for:"email"},Z=["placeholder"],$={key:0,class:"error-message"},x={class:"form-group"},ee={for:"password"},re={class:"password-input-container"},se=["type","placeholder"],oe={key:0,class:"error-message"},te={class:"form-group"},ie={for:"confirmPassword"},ae={class:"password-input-container"},ne=["type","placeholder"],le={key:0,class:"error-message"},de={class:"form-group"},he={for:"country"},me={class:"country-option"},ue={class:"country-name"},ce={class:"country-code"},fe={key:0,class:"error-message"},pe={class:"form-group"},ge={for:"phoneNumber"},we={class:"phone-input-container"},ye={class:"country-code-input"},Ne=["placeholder"],be=["placeholder"],Ce={key:0,class:"error-message"},ve={type:"submit",class:"submit-btn"},Pe={class:"register-section"};function _e(e,r,n,h,s,i){const u=D("el-option"),c=D("el-select"),C=D("router-link");return d(),m("div",B,[r[19]||(r[19]=o("div",{class:"banner-section"},null,-1)),o("div",T,[o("div",K,[o("h1",H,a(e.$t("header.register")),1),o("p",z,a(e.$t("header.register")),1)]),o("form",{onSubmit:r[17]||(r[17]=g((...t)=>i.handleRegister&&i.handleRegister(...t),["prevent"])),class:"join-form"},[o("div",J,[o("label",Q,a(e.$t("header.fullName")),1),w(o("input",{type:"text",id:"fullName","onUpdate:modelValue":r[0]||(r[0]=t=>s.formData.fullName=t),placeholder:e.$t("header.fullNamePlaceholder"),class:b({error:s.errors.fullName,valid:s.formData.fullName&&!s.errors.fullName}),required:""},null,10,X),[[P,s.formData.fullName]]),s.errors.fullName?(d(),m("span",Y,a(s.errors.fullName),1)):y("",!0)]),o("div",G,[o("label",W,a(e.$t("header.email")),1),w(o("input",{type:"email",id:"email","onUpdate:modelValue":r[1]||(r[1]=t=>s.formData.email=t),placeholder:e.$t("header.emailPlaceholder"),class:b({error:s.errors.email,valid:s.formData.email&&!s.errors.email}),required:""},null,10,Z),[[P,s.formData.email]]),s.errors.email?(d(),m("span",$,a(s.errors.email),1)):y("",!0)]),o("div",x,[o("label",ee,a(e.$t("header.password")),1),o("div",re,[w(o("input",{type:s.showPassword?"text":"password",id:"password","onUpdate:modelValue":r[2]||(r[2]=t=>s.formData.password=t),placeholder:e.$t("header.passwordPlaceholder"),class:b({error:s.errors.password,valid:s.formData.password&&!s.errors.password}),required:"",onCopy:r[3]||(r[3]=g(()=>{},["prevent"])),onCut:r[4]||(r[4]=g(()=>{},["prevent"])),onPaste:r[5]||(r[5]=g(()=>{},["prevent"]))},null,42,se),[[q,s.formData.password]]),o("button",{type:"button",class:"show-password-btn",onClick:r[6]||(r[6]=(...t)=>i.togglePassword&&i.togglePassword(...t))},a(s.showPassword?e.$t("joinUs.hidePassword"):e.$t("joinUs.showPassword")),1),o("button",{type:"button",class:"copy-password-btn",onClick:r[7]||(r[7]=t=>i.copyPassword(s.formData.password))})]),s.errors.password?(d(),m("span",oe,a(s.errors.password),1)):y("",!0)]),o("div",te,[o("label",ie,a(e.$t("header.confirmPassword")),1),o("div",ae,[w(o("input",{type:s.showConfirmPassword?"text":"password",id:"confirmPassword","onUpdate:modelValue":r[8]||(r[8]=t=>s.formData.confirmPassword=t),placeholder:e.$t("register.confirmPasswordPlaceholder"),class:b({error:s.errors.confirmPassword,valid:s.formData.confirmPassword&&!s.errors.confirmPassword}),required:"",onCopy:r[9]||(r[9]=g(()=>{},["prevent"])),onCut:r[10]||(r[10]=g(()=>{},["prevent"])),onPaste:r[11]||(r[11]=g(()=>{},["prevent"]))},null,42,ne),[[q,s.formData.confirmPassword]]),o("button",{type:"button",class:"show-password-btn",onClick:r[12]||(r[12]=(...t)=>i.toggleConfirmPassword&&i.toggleConfirmPassword(...t))},a(s.showConfirmPassword?e.$t("joinUs.hidePassword"):e.$t("joinUs.showPassword")),1)]),s.errors.confirmPassword?(d(),m("span",le,a(s.errors.confirmPassword),1)):y("",!0)]),o("div",de,[o("label",he,a(e.$t("register.country")),1),F(c,{modelValue:s.formData.country_id,"onUpdate:modelValue":r[13]||(r[13]=t=>s.formData.country_id=t),class:"country-select",placeholder:e.$t("register.countryPlaceholder"),loading:s.loading,filterable:"","filter-method":i.filterCountries,"remote-method":i.filterCountries,remote:!1,required:""},{default:k(()=>[(d(!0),m(M,null,A(s.filteredCountries,t=>(d(),S(u,{key:t.id,label:i.getCountryName(t),value:t.id},{default:k(()=>[o("div",me,[o("span",ue,a(i.getCountryName(t)),1),o("span",ce,"+"+a(i.getCountryCode(t.id)),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading","filter-method","remote-method"]),s.errors.country_id?(d(),m("span",fe,a(s.errors.country_id),1)):y("",!0)]),o("div",pe,[o("label",ge,a(e.$t("register.phoneNumber")),1),o("div",we,[o("div",ye,[r[18]||(r[18]=o("span",{class:"plus"},"+",-1)),w(o("input",{type:"text","onUpdate:modelValue":r[14]||(r[14]=t=>s.countryCode=t),class:"country-code-field",readonly:"",placeholder:i.selectedCountryDialCode||"Code"},null,8,Ne),[[P,s.countryCode]])]),w(o("input",{type:"tel",id:"phoneNumber","onUpdate:modelValue":r[15]||(r[15]=t=>s.phoneNumber=t),placeholder:e.$t("register.phoneNumberPlaceholder"),class:b({error:s.errors.phoneNumber,valid:s.phoneNumber&&!s.errors.phoneNumber}),required:"",minlength:"8",maxlength:"18",onInput:r[16]||(r[16]=(...t)=>i.formatPhoneNumber&&i.formatPhoneNumber(...t))},null,42,be),[[P,s.phoneNumber]])]),s.errors.phoneNumber?(d(),m("span",Ce,a(s.errors.phoneNumber),1)):y("",!0)]),o("button",ve,a(e.$t("register.submit")),1),o("div",Pe,[o("p",null,[j(a(e.$t("register.alreadyHaveAccount"))+" ",1),F(C,{to:"/account/login",class:"link"},{default:k(()=>[j(a(e.$t("register.loginHere")),1)]),_:1})])])],32)])])}const ke=L(O,[["render",_e],["__scopeId","data-v-54c6c43c"]]);export{ke as default};
