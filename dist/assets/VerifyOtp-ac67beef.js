import{_ as y,b as f,r as k,o as m,c as g,a as n,m as w,t as u,g as _,F as I,d as M,i as O,f as S,e as b,j as V,w as T,v as $}from"./index-50b21e1d.js";const v="https://massagebackend.webenia.org/api",N={data(){return{otp:Array(4).fill(""),user:null,token:null,timer:"03:00",countdown:null,otpMessage:""}},computed:{otpMessageColor(){return this.otpMessage==="Invalid OTP"||this.otpMessage==="Resend Invalid"?"red":"#333"},isOtpComplete(){return this.otp.every(e=>/^\d$/.test(e))}},created(){const e=localStorage.getItem("user"),t=localStorage.getItem("auth_token"),s=localStorage.getItem("otp_email");this.user=e?JSON.parse(e):{},this.token=t,s&&(this.user||(this.user={}),this.user.email=s),this.startTimer()},methods:{focusNext(e){e<4&&this.otp[e-1]&&this.$el.querySelectorAll(".otp-input")[e].focus()},handleInput(e,t){const s=e.target.value;/^\d$/.test(s)?(this.otp[t-1]=s,t<4&&this.focusNext(t)):this.otp[t-1]=""},handleKeyDown(e,t){e.key==="Backspace"&&!this.otp[t-1]&&t>1&&this.$el.querySelectorAll(".otp-input")[t-2].focus()},async handleOtpVerification(){var s,d,i,r,p,a,o,l;const e=this.otp.join(""),t=this.otp.every(c=>/^\d$/.test(c));if(e.length!==4||!t){(i=(s=this.$toast)==null?void 0:s.error)==null||i.call(s,((d=this.$t)==null?void 0:d.call(this,"otp.invalidLength"))||"Please enter a valid 4-digit code");return}try{const c=await f.post(`${v}/check-otp`,{otp:e,email:this.user.email},{headers:{Authorization:`Bearer ${this.token}`}});if(c.data.status===!0){const h={...this.user,...c.data.data.user};localStorage.setItem("user",JSON.stringify(h)),localStorage.setItem("auth_token",c.data.data.token),this.otpMessage="",this.$router.push({path:"/reset-password",query:{email:this.user.email,token:e}})}}catch(c){console.error("OTP verification error:",c);const h=((p=(r=c.response)==null?void 0:r.data)==null?void 0:p.message)||((a=this.$t)==null?void 0:a.call(this,"otp.error"))||"OTP verification failed";this.otpMessage=h,(l=(o=this.$toast)==null?void 0:o.error)==null||l.call(o,h)}},startTimer(){let e=3,t=0;this.countdown=setInterval(()=>{if(t===0){if(e===0){clearInterval(this.countdown);return}e--,t=59}else t--;this.timer=`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}`},1e3)},async resendOtp(){var e,t,s,d,i,r,p,a;try{const o=await f.post(`${v}/resend-otp`,{email:this.user.email});if(o.data.status===!0){const l=o.data.message||"OTP resent successfully.";this.otpMessage=l,(t=(e=this.$toast)==null?void 0:e.info)==null||t.call(e,l)}else{const l=o.data.message||"Resend Invalid";this.otpMessage=l,(d=(s=this.$toast)==null?void 0:s.error)==null||d.call(s,l)}this.startTimer()}catch(o){const l=((r=(i=o.response)==null?void 0:i.data)==null?void 0:r.message)||"Resend Invalid";this.otpMessage=l,(a=(p=this.$toast)==null?void 0:p.error)==null||a.call(p,l)}}}},C={class:"otp-wrapper"},D={class:"otp-container"},P={class:"otp-message"},A={class:"otp-input-group"},B=["onUpdate:modelValue","onInput","onKeydown"],K=["disabled"],L={class:"resend d-flex w-100 justify-content-between align-items-center mt-3"},R={class:"time-left"},j=["disabled"];function q(e,t,s,d,i,r){const p=k("fa");return m(),g("div",C,[n("div",D,[t[2]||(t[2]=n("img",{src:w,alt:"Logo",height:"100"},null,-1)),n("p",P,u(e.$t("otp.message")),1),n("span",null,u(i.user.email),1),n("form",{onSubmit:t[0]||(t[0]=_((...a)=>r.handleOtpVerification&&r.handleOtpVerification(...a),["prevent"]))},[n("div",A,[(m(),g(I,null,M(4,a=>T(n("input",{dir:"ltr",key:a,type:"text",inputmode:"numeric",maxlength:"1",pattern:"[0-9]*","onUpdate:modelValue":o=>i.otp[a-1]=o,onInput:o=>r.handleInput(o,a),onKeydown:o=>r.handleKeyDown(o,a),class:"otp-input",placeholder:"_"},null,40,B),[[$,i.otp[a-1]]])),64))]),n("button",{type:"submit",disabled:!r.isOtpComplete,class:"verify-btn"},u(e.$t("otp.verify")),9,K),i.otpMessage?(m(),g("div",{key:0,class:"info-message",style:O({marginTop:"1rem",color:r.otpMessageColor})},u(i.otpMessage),5)):S("",!0)],32),n("div",L,[n("div",R,[n("span",null,u(i.timer),1)]),n("button",{class:"btn btn-link",disabled:i.timer!=="00:00",onClick:t[1]||(t[1]=_((...a)=>r.resendOtp&&r.resendOtp(...a),["prevent"]))},[b(p,{icon:"rotate-right"}),V(" "+u(e.$t("otp.resend")),1)],8,j)])])])}const x=y(N,[["render",q],["__scopeId","data-v-a13f3862"]]);export{x as default};
