import{_ as b,h as c,E as v,r as _,o as m,c as g,a as s,t as l,i as u,l as y,Q as w,G as p,R as f,b as C,w as k,F as M,k as B,m as E}from"./index-8c31c214.js";const S={name:"EditCategory",data(){return{form:{name:"",name_ar:"",description_en:"",description_ar:"",brand_id:"",image:null},imagePreview:null,brands:[],successMessage:"",errorMessage:"",loading:!1,domain_Img:"https://massagebackend.webenia.org/public/storage/"}},created(){this.fetchBrands(),this.fetchCategory()},methods:{async fetchBrands(){try{const t=JSON.parse(localStorage.getItem("tokenData"));t!=null&&t.token&&(c.defaults.headers.common.Authorization=`Bearer ${t.token}`);const e=await c.get("https://massagebackend.webenia.org/api/brands");if(e.data.status){const d=e.data.data;this.brands=Array.isArray(d)?d:[d]}else throw new Error(e.data.message||"Failed to fetch brands")}catch(t){console.error("Error fetching brands:",t),v.error("Failed to load brands")}},async fetchCategory(){var t,e,d;this.loading=!0;try{const n=JSON.parse(localStorage.getItem("tokenData"));n!=null&&n.token&&(c.defaults.headers.common.Authorization=`Bearer ${n.token}`);const a=this.$route.params.id,o=await c.get(`https://massagebackend.webenia.org/api/categories/${a}`);if(o.data.status&&o.data.data){const i=o.data.data;this.form={name:i.name_en||"",name_ar:i.name_ar||"",description_en:i.description_en||"",description_ar:i.description_ar||"",brand_id:i.brand_id||"",image:null},i.images&&(this.imagePreview=`${this.domain_Img}${((t=i.images[0])==null?void 0:t.path)||""}`)}else throw new Error(o.data.message||"Failed to fetch category")}catch(n){this.errorMessage=((d=(e=n.response)==null?void 0:e.data)==null?void 0:d.message)||n.message||"An error occurred while fetching the category."}finally{this.loading=!1}},onFileChange(t){const e=t.target.files[0];e?(this.form.image=e,this.imagePreview=URL.createObjectURL(e)):(this.form.image=null,this.imagePreview=null)},async submitCategory(){var t,e,d,n,a;this.successMessage="",this.errorMessage="",this.loading=!0;try{const o=new FormData;o.append("name_en",this.form.name),o.append("name_ar",this.form.name_ar),o.append("description_en",this.form.description_en),o.append("description_ar",this.form.description_ar),o.append("brand_id",this.form.brand_id),this.form.image&&o.append("image",this.form.image);const i=JSON.parse(localStorage.getItem("tokenData"));i!=null&&i.token&&(c.defaults.headers.common.Authorization=`Bearer ${i.token}`);const h=this.$route.params.id,r=await c.post(`https://massagebackend.webenia.org/api/categories/${h}`,o,{headers:{"Content-Type":"multipart/form-data"}});if((t=r.data)!=null&&t.status&&((e=r.data)!=null&&e.data))this.loading=!1,this.successMessage="Category updated successfully!",setTimeout(()=>{this.$router.push("/categories")},1500);else throw new Error(((d=r.data)==null?void 0:d.message)||"Failed to update category")}catch(o){this.loading=!1,this.errorMessage=((a=(n=o.response)==null?void 0:n.data)==null?void 0:a.message)||o.message||"An error occurred while updating the category."}}}},F={class:"category-edit"},I={class:"form-card"},V={class:"form-title"},A={key:0,class:"loading-overlay"},N={key:1,class:"success-message"},P={key:2,class:"error-message"},U={class:"form-group"},D={class:"form-group"},q={class:"form-group"},z={class:"form-group"},O={class:"form-group"},J={class:"form-group"},L=["value"],R={class:"form-group"},T={class:"file-input-wrapper"},j={key:0,class:"image-preview-container"},x={class:"preview-title"},G={class:"image-preview"},Q=["src"],H={type:"submit",class:"submit-button"};function K(t,e,d,n,a,o){const i=_("el-option"),h=_("el-select");return m(),g("div",F,[s("div",I,[s("h2",V,l(t.$t("Categories.EditCategory")),1),a.loading?(m(),g("div",A,e[7]||(e[7]=[s("span",{class:"spinner"},null,-1)]))):u("",!0),a.successMessage?(m(),g("div",N,l(a.successMessage),1)):u("",!0),a.errorMessage?(m(),g("div",P,l(a.errorMessage),1)):u("",!0),s("form",{onSubmit:e[6]||(e[6]=y((...r)=>o.submitCategory&&o.submitCategory(...r),["prevent"])),style:w(a.loading?"pointer-events:none;opacity:0.5;":"")},[s("div",U,[s("label",null,l(t.$t("Categories.NameEn")),1),p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>a.form.name=r),required:"",class:"form-input"},null,512),[[f,a.form.name]])]),s("div",D,[s("label",null,l(t.$t("Categories.NameAr")),1),p(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>a.form.name_ar=r),required:"",class:"form-input"},null,512),[[f,a.form.name_ar]])]),s("div",q,[s("label",null,l(t.$t("Categories.DescriptionEn")),1),p(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>a.form.description_en=r),required:"",class:"form-input form-textarea"},null,512),[[f,a.form.description_en]])]),s("div",z,[s("label",null,l(t.$t("Categories.DescriptionAr")),1),p(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=r=>a.form.description_ar=r),required:"",class:"form-input form-textarea"},null,512),[[f,a.form.description_ar]])]),s("div",O,[s("label",null,l(t.$t("Categories.Brand")),1),C(h,{modelValue:a.form.brand_id,"onUpdate:modelValue":e[4]||(e[4]=r=>a.form.brand_id=r),placeholder:t.$t("Categories.SelectBrand"),filterable:"",clearable:"",class:"form-input"},{default:k(()=>[(m(!0),g(M,null,B(a.brands,r=>(m(),E(i,{key:r.id,label:r.name_en,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),s("div",J,[e[8]||(e[8]=s("label",null,"Selected Brand ID",-1)),s("input",{class:"form-input",value:a.form.brand_id,readonly:""},null,8,L)]),s("div",R,[s("label",null,l(t.$t("Categories.Image")),1),s("div",T,[s("input",{type:"file",onChange:e[5]||(e[5]=(...r)=>o.onFileChange&&o.onFileChange(...r)),accept:"image/*",class:"form-input file-input"},null,32)])]),a.imagePreview?(m(),g("div",j,[s("p",x,l(t.$t("Categories.ImagePreview")),1),s("div",G,[s("img",{src:a.imagePreview,alt:"Image Preview"},null,8,Q)])])):u("",!0),s("button",H,l(t.$t("Categories.UpdateButton")),1)],36)])])}const X=b(S,[["render",K],["__scopeId","data-v-4ffab251"]]);export{X as default};
