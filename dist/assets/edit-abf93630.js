import{_ as b,I as C,h as c,E as I,r as w,o as g,c as p,a as t,t as n,i as f,l as k,T as U,H as _,U as v,b as u,w as y}from"./index-0e709365.js";const A={name:"EditCategory",components:{Picture:C},data(){return{form:{name:"",name_ar:"",description_en:"",description_ar:"",brand_id:"",image:null},imagePreview:null,originalImageUrl:null,brands:[],successMessage:"",errorMessage:"",loading:!1,domain_Img:"https://backend.msgperfumes.com/public/storage/",BASE_URL:"https://backend.msgperfumes.com"}},created(){this.fetchBrands(),this.fetchCategory()},methods:{resolveImageUrl(e){if(!e)return null;if(/^https?:\/\//i.test(e))return e;const s=e.replace(/^\/+/,"").replace(/\/{2,}/g,"/");return`${this.BASE_URL}/public/storage/${s}`},extractFirstImagePath(e){var s,i,m,r,a;return e?Array.isArray(e.images)&&((s=e.images[0])!=null&&s.path)?e.images[0].path:(i=e.images)!=null&&i.data&&Array.isArray(e.images.data)&&((m=e.images.data[0])!=null&&m.path)?e.images.data[0].path:(r=e.image)!=null&&r.path?e.image.path:typeof e.image=="string"?e.image:(a=e.logo)!=null&&a.path?e.logo.path:typeof e.image_url=="string"?e.image_url:null:null},async fetchBrands(){try{const e=JSON.parse(localStorage.getItem("tokenData"));e!=null&&e.token&&(c.defaults.headers.common.Authorization=`Bearer ${e.token}`);const s=await c.get("https://backend.msgperfumes.com/api/brands");if(s.data.status){const i=s.data.data;this.brands=Array.isArray(i)?i:[i]}else throw new Error(s.data.message||"Failed to fetch brands")}catch(e){console.error("Error fetching brands:",e),I.error("Failed to load brands")}},async fetchCategory(){var e,s;this.loading=!0;try{const i=JSON.parse(localStorage.getItem("tokenData"));i!=null&&i.token&&(c.defaults.headers.common.Authorization=`Bearer ${i.token}`);const m=this.$route.params.id,r=await c.get(`https://backend.msgperfumes.com/api/categories/${m}`);if(r.data.status&&r.data.data){const a=r.data.data;this.form={name:a.name_en||"",name_ar:a.name_ar||"",description_en:a.description_en||"",description_ar:a.description_ar||"",brand_id:a.brand_id||"",image:null};const l=this.extractFirstImagePath(a);this.originalImageUrl=this.resolveImageUrl(l)}else throw new Error(r.data.message||"Failed to fetch category")}catch(i){this.errorMessage=((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.message)||i.message||"An error occurred while fetching the category."}finally{this.loading=!1}},onFileChange(e){const s=e.target.files[0];s?(this.form.image=s,this.imagePreview=URL.createObjectURL(s)):(this.form.image=null,this.imagePreview=null)},async submitCategory(){var e,s,i,m,r;this.successMessage="",this.errorMessage="",this.loading=!0;try{const a=new FormData;a.append("name_en",this.form.name),a.append("name_ar",this.form.name_ar),a.append("description_en",this.form.description_en),a.append("description_ar",this.form.description_ar),a.append("brand_id",this.form.brand_id),this.form.image&&a.append("image",this.form.image);const l=JSON.parse(localStorage.getItem("tokenData"));l!=null&&l.token&&(c.defaults.headers.common.Authorization=`Bearer ${l.token}`);const h=this.$route.params.id,d=await c.post(`https://backend.msgperfumes.com/api/categories/${h}`,a,{headers:{"Content-Type":"multipart/form-data"}});if((e=d.data)!=null&&e.status&&((s=d.data)!=null&&s.data))this.loading=!1,this.successMessage="Category updated successfully!",setTimeout(()=>{this.$router.push("/categories")},1500);else throw new Error(((i=d.data)==null?void 0:i.message)||"Failed to update category")}catch(a){this.loading=!1,this.errorMessage=((r=(m=a.response)==null?void 0:m.data)==null?void 0:r.message)||a.message||"An error occurred while updating the category."}}}},M={class:"category-edit"},P={class:"form-card"},E={class:"form-title"},B={key:0,class:"loading-overlay"},S={key:1,class:"success-message"},F={key:2,class:"error-message"},N={class:"form-group"},V={class:"form-group"},x={class:"form-group"},D={class:"form-group"},z={class:"form-group"},q={class:"file-input-wrapper"},L={key:0,class:"image-preview-container"},O={class:"preview-title"},R={class:"image-preview"},T={class:"image-error"},J={key:1,class:"image-preview-container"},j={class:"preview-title"},H={class:"image-preview"},G={class:"image-error"},K={type:"submit",class:"submit-button"};function Q(e,s,i,m,r,a){const l=w("Picture"),h=w("el-icon"),d=w("el-image");return g(),p("div",M,[t("div",P,[t("h2",E,n(e.$t("Categories.EditCategory")),1),r.loading?(g(),p("div",B,[...s[6]||(s[6]=[t("span",{class:"spinner"},null,-1)])])):f("",!0),r.successMessage?(g(),p("div",S,n(r.successMessage),1)):f("",!0),r.errorMessage?(g(),p("div",F,n(r.errorMessage),1)):f("",!0),t("form",{onSubmit:s[5]||(s[5]=k((...o)=>a.submitCategory&&a.submitCategory(...o),["prevent"])),style:U(r.loading?"pointer-events:none;opacity:0.5;":"")},[t("div",N,[t("label",null,n(e.$t("Categories.NameEn")),1),_(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>r.form.name=o),required:"",class:"form-input"},null,512),[[v,r.form.name]])]),t("div",V,[t("label",null,n(e.$t("Categories.NameAr")),1),_(t("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>r.form.name_ar=o),required:"",class:"form-input"},null,512),[[v,r.form.name_ar]])]),t("div",x,[t("label",null,n(e.$t("Categories.DescriptionEn")),1),_(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=o=>r.form.description_en=o),required:"",class:"form-input form-textarea"},null,512),[[v,r.form.description_en]])]),t("div",D,[t("label",null,n(e.$t("Categories.DescriptionAr")),1),_(t("textarea",{"onUpdate:modelValue":s[3]||(s[3]=o=>r.form.description_ar=o),required:"",class:"form-input form-textarea"},null,512),[[v,r.form.description_ar]])]),t("div",z,[t("label",null,n(e.$t("Categories.Image")),1),t("div",q,[t("input",{type:"file",onChange:s[4]||(s[4]=(...o)=>a.onFileChange&&a.onFileChange(...o)),accept:"image/*",class:"form-input file-input"},null,32)])]),r.originalImageUrl?(g(),p("div",L,[t("p",O,n(e.$t("Categories.CurrentImage")||"Current Image"),1),t("div",R,[u(d,{src:r.originalImageUrl,fit:"contain",class:"edit-image","preview-src-list":[r.originalImageUrl],"initial-index":0,"preview-teleported":""},{error:y(()=>[t("div",T,[u(h,null,{default:y(()=>[u(l)]),_:1})])]),_:1},8,["src","preview-src-list"])])])):f("",!0),r.imagePreview?(g(),p("div",J,[t("p",j,n(e.$t("Categories.ImagePreview")||"New Image Preview"),1),t("div",H,[u(d,{src:r.imagePreview,fit:"contain",class:"edit-image","preview-src-list":[r.imagePreview],"initial-index":0,"preview-teleported":""},{error:y(()=>[t("div",G,[u(h,null,{default:y(()=>[u(l)]),_:1})])]),_:1},8,["src","preview-src-list"])])])):f("",!0),t("button",K,n(e.$t("Categories.UpdateButton")),1)],36)])])}const X=b(A,[["render",Q],["__scopeId","data-v-0c0efec5"]]);export{X as default};
