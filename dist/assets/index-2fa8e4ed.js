import{_ as he,s as be,V as we,e as _,B as Q,f as $e,r as s,G as Pe,o as $,c as L,a as m,t as i,b as a,w as o,K as f,h as p,E as c,j as g,z as j,L as ke,H as J,m as O,I as Y,N as Ve,x as De,y as Ae,W as Ce,X as Ie,Y as Ue,F as Ee,k as Se,U as G,D as Ne}from"./index-d33f2148.js";const Be={class:"products-container"},Fe={class:"header"},ze={class:"d-flex justify-content-between align-items-center w-100"},qe={class:"image-error"},Le={key:1,class:"image-error"},Je={dir:"rtl"},Oe={class:"icon-actions",dir:"ltr",role:"group","aria-label":"Row actions"},Me={class:"dialog-footer"},w="https://massagebackend.webenia.org",Te={__name:"index",setup(Re){const N=be(),{t:U}=we(),P=_([]),k=_(!1),E=_(""),H=Q(()=>{if(!E.value)return P.value;const e=E.value.toLowerCase();return P.value.filter(t=>t.name_en&&t.name_en.toLowerCase().includes(e)||t.name_ar&&t.name_ar.toLowerCase().includes(e))}),d=localStorage.getItem("lang")||"en",M=`${w}/api/dashboard/products`,T=async()=>{k.value=!0;try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await p.get(M);if(t.data.status)P.value=t.data.data;else throw new Error(t.data.message||"Failed to fetch products")}catch(e){console.error("Fetch products error:",e),c.error(d==="ar"?"فشل في تحميل المنتجات":"Failed to load products")}finally{k.value=!1}},K=()=>{N.push("/products/create")},X=e=>{N.push(`/products/${e}`)},Z=e=>{N.push(`/products/${e.id}/edit`)},x=async e=>{try{if(await Ne.confirm(U("Products.DeleteConfirmation"),U("Products.Warning"),{confirmButtonText:U("Products.Yes"),cancelButtonText:U("Products.No"),type:"warning"})==="confirm"){k.value=!0;const r=JSON.parse(localStorage.getItem("tokenData"));if(!r||!r.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${r.token}`;const u=await p.delete(`${M}/${e.id}`);if(u.data.status)c.success(d==="ar"?"تم حذف المنتج بنجاح":"Product deleted successfully"),P.value=P.value.filter(h=>h.id!==e.id);else throw new Error(u.data.message||"Failed to delete product")}}catch(t){t!=="cancel"&&(console.error("Delete product error:",t),c.error(d==="ar"?"فشل في حذف المنتج":"Failed to delete product"))}finally{k.value=!1}},V=_(!1),D=_(null),R=_([]),v=_({unit_id:"",weight:"",price:""}),ee=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await p.get(`${w}/api/units`);R.value=t.data.data}catch(e){console.error("Failed to fetch units:",e),c.error(d==="ar"?"فشل في تحميل الوحدات":"Failed to load units")}},te=e=>{D.value=e,v.value={unit_id:"",weight:"",price:""},ee(),V.value=!0},ae=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t={product_id:D.value.id,unit_id:v.value.unit_id,weight:v.value.weight,price:v.value.price};(await p.post(`${w}/api/amounts`,t)).data.status?(c.success(d==="ar"?"تم إضافة الكمية بنجاح":"Amount added successfully"),V.value=!1):c.error(d==="ar"?"فشل في إضافة الكمية":"Failed to add amount")}catch(e){console.error(e),c.error(d==="ar"?"حدث خطأ أثناء حفظ الكمية":"Error occurred while saving amount")}},A=_(!1),n=_({start_date:"",duration:"",discount_value:"",is_active:!1,product_id:"",category_id:"",end_date:""}),le=e=>{D.value=e,n.value={start_date:"",duration:"",discount_value:"",is_active:!1,product_id:e.id,category_id:e.category_id||"",end_date:""},A.value=!0},oe=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t={start_date:n.value.start_date,duration:n.value.duration,discount_value:n.value.discount_value,is_active:n.value.is_active,product_id:n.value.product_id,category_id:n.value.category_id,end_date:n.value.end_date};(await p.post(`${w}/api/discounts`,t)).data?(c.success(d==="ar"?"تم إضافة الخصم بنجاح":"Discount added successfully"),A.value=!1):c.error(d==="ar"?"فشل في إضافة الخصم":"Failed to add discount")}catch(e){console.error(e),c.error(d==="ar"?"حدث خطأ أثناء حفظ الخصم":"Error occurred while saving discount")}},ne=Q(()=>window.innerWidth<=768),re=e=>(Array.isArray(e==null?void 0:e.inventory_items)?e.inventory_items:[]).reduce((r,u)=>r+(Number(u==null?void 0:u.quantity)||0),0),se=(e,t)=>{switch(e){case"add-amount":return te(t);case"add-discount":return le(t);case"increase-inventory":return de(t)}},C=_(!1),I=_({quantity:""}),de=e=>{D.value=e,I.value={quantity:""},C.value=!0},ue=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t={product_id:D.value.id,quantity:Number(I.value.quantity)};(await p.post(`${w}/api/inventory-items/increase`,t)).data?(c.success(d==="ar"?"تم تحديث المخزون":"Inventory updated"),C.value=!1,await T()):c.error(d==="ar"?"فشل في تحديث المخزون":"Failed to update inventory")}catch(e){console.error(e),c.error(d==="ar"?"حدث خطأ أثناء تحديث المخزون":"Error occurred while updating inventory")}};return $e(()=>{T()}),(e,t)=>{const r=s("el-button"),u=s("el-input"),h=s("el-icon"),ie=s("el-image"),b=s("el-table-column"),B=s("el-tooltip"),F=s("el-dropdown-item"),ce=s("el-dropdown-menu"),me=s("el-dropdown"),pe=s("el-table"),ve=s("el-card"),_e=s("el-option"),fe=s("el-select"),y=s("el-form-item"),z=s("el-form"),q=s("el-dialog"),W=s("el-date-picker"),ye=s("el-switch"),ge=Pe("loading");return $(),L("div",Be,[m("div",Fe,[m("div",ze,[m("h2",null,i(e.$t("Products.Products")),1),a(r,{type:"primary",icon:f(j),onClick:K},{default:o(()=>[g(i(e.$t("Products.AddProduct")),1)]),_:1},8,["icon"])]),a(u,{modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=l=>E.value=l),placeholder:e.$t("Products.SearchPlaceholder"),"prefix-icon":f(ke),clearable:"",class:"search-input",style:{"max-width":"250px","margin-right":"16px"}},null,8,["modelValue","placeholder","prefix-icon"])]),a(ve,{class:"products-table"},{default:o(()=>[J(($(),O(pe,{data:H.value,class:"table-responsivew",style:{height:"70vh"},dir:"ltr"},{default:o(()=>[a(b,{label:e.$t("Products.Image"),width:"120"},{default:o(({row:l})=>[l.images&&l.images.length>0?($(),O(ie,{key:0,src:w+"/public/storage/"+l.images[0].path,fit:"cover",class:"product-image","preview-src-list":[w+"/public/storage/"+l.images[0].path],"initial-index":0,"preview-teleported":""},{error:o(()=>[m("div",qe,[a(h,null,{default:o(()=>[a(f(Y))]),_:1})])]),_:1},8,["src","preview-src-list"])):($(),L("div",Le,[a(h,null,{default:o(()=>[a(f(Y))]),_:1})]))]),_:1},8,["label"]),a(b,{prop:"name_en",label:e.$t("Products.NameEn")},null,8,["label"]),a(b,{prop:"name_ar",label:e.$t("Products.NameAr")},{default:o(({row:l})=>[m("div",Je,i(l.name_ar||e.$t("Products.NA")),1)]),_:1},8,["label"]),a(b,{prop:"price",label:e.$t("Products.Price")},null,8,["label"]),a(b,{label:e.$t("Products.Inventory")},{default:o(({row:l})=>[g(i(re(l)),1)]),_:1},8,["label"]),a(b,{prop:"currency.name_en",label:e.$t("Products.Currency")},null,8,["label"]),a(b,{label:e.$t("Products.Actions"),width:"250"},{default:o(({row:l})=>[m("div",Oe,[a(B,{content:e.$t("Products.View"),placement:"top"},{default:o(()=>[a(r,{size:"small",circle:"",type:"success",icon:f(Ve),onClick:S=>X(l.id)},null,8,["icon","onClick"])]),_:2},1032,["content"]),a(B,{content:e.$t("Products.Edit"),placement:"top"},{default:o(()=>[a(r,{size:"small",circle:"",type:"warning",icon:f(De),onClick:S=>Z(l)},null,8,["icon","onClick"])]),_:2},1032,["content"]),a(B,{content:e.$t("Products.Delete"),placement:"top"},{default:o(()=>[a(r,{size:"small",circle:"",type:"danger",icon:f(Ae),onClick:S=>x(l)},null,8,["icon","onClick"])]),_:2},1032,["content"]),a(me,{trigger:"click",placement:"bottom-start",onCommand:S=>se(S,l)},{dropdown:o(()=>[a(ce,{class:"add-menu"},{default:o(()=>[a(F,{command:"add-amount"},{default:o(()=>[a(h,{class:"menu-icon success"},{default:o(()=>[a(f(j))]),_:1}),m("span",null,i(e.$t("Products.addAmount")),1)]),_:1}),a(F,{command:"add-discount"},{default:o(()=>[a(h,{class:"menu-icon warning"},{default:o(()=>[a(f(Ce))]),_:1}),m("span",null,i(e.$t("Products.addDiscount")),1)]),_:1}),a(F,{command:"increase-inventory"},{default:o(()=>[a(h,{class:"menu-icon primary"},{default:o(()=>[a(f(Ie))]),_:1}),m("span",null,i(e.$t("Products.IncreaseInventory")),1)]),_:1})]),_:1})]),default:o(()=>[a(r,{size:"small",class:"more-btn",circle:"",icon:f(Ue)},null,8,["icon"])]),_:1},8,["onCommand"])])]),_:1},8,["label"])]),_:1},8,["data"])),[[ge,k.value]])]),_:1}),a(q,{modelValue:V.value,"onUpdate:modelValue":t[5]||(t[5]=l=>V.value=l),title:e.$t("Products.AddAmount"),width:"500px"},{footer:o(()=>[a(r,{onClick:t[4]||(t[4]=l=>V.value=!1)},{default:o(()=>[g(i(e.$t("Products.cancel")),1)]),_:1}),a(r,{type:"primary",class:"mx-2",onClick:ae},{default:o(()=>[g(i(e.$t("Products.submit")),1)]),_:1})]),default:o(()=>[a(z,{model:v.value,"label-width":"100px"},{default:o(()=>[a(y,{label:e.$t("Products.Unit")},{default:o(()=>[a(fe,{modelValue:v.value.unit_id,"onUpdate:modelValue":t[1]||(t[1]=l=>v.value.unit_id=l),placeholder:e.$t("Products.select-unit")},{default:o(()=>[($(!0),L(Ee,null,Se(R.value,l=>($(),O(_e,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(y,{label:e.$t("Products.Weight")},{default:o(()=>[a(u,{modelValue:v.value.weight,"onUpdate:modelValue":t[2]||(t[2]=l=>v.value.weight=l),type:"number",placeholder:e.$t("Products.select-weight")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(y,{label:e.$t("Products.Price")},{default:o(()=>[a(u,{modelValue:v.value.price,"onUpdate:modelValue":t[3]||(t[3]=l=>v.value.price=l),type:"number",placeholder:e.$t("Products.select-price")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(q,{modelValue:A.value,"onUpdate:modelValue":t[14]||(t[14]=l=>A.value=l),title:e.$t("Products.addDiscount"),width:ne.value?"90%":"500px",class:"discount-dialog"},{footer:o(()=>[m("div",Me,[a(r,{onClick:t[13]||(t[13]=l=>A.value=!1)},{default:o(()=>[g(i(e.$t("Products.cancel")),1)]),_:1}),a(r,{type:"primary",onClick:oe},{default:o(()=>[g(i(e.$t("Products.submit")),1)]),_:1})])]),default:o(()=>[a(z,{model:n.value,"label-width":"100px",class:"discount-form"},{default:o(()=>[a(y,{label:e.$t("Products.Start-Date")},{default:o(()=>[a(W,{modelValue:n.value.start_date,"onUpdate:modelValue":t[6]||(t[6]=l=>n.value.start_date=l),type:"date",placeholder:e.$t("Products.Select-start-date"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(y,{label:e.$t("Products.Duration-days")},{default:o(()=>[a(u,{modelValue:n.value.duration,"onUpdate:modelValue":t[7]||(t[7]=l=>n.value.duration=l),type:"number",placeholder:e.$t("Products.Enter-duration-days"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(y,{label:e.$t("Products.Discount-Value")},{default:o(()=>[a(u,{modelValue:n.value.discount_value,"onUpdate:modelValue":t[8]||(t[8]=l=>n.value.discount_value=l),type:"number",placeholder:e.$t("Products.Enter-discount-percentage"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(y,{label:e.$t("Products.Is-Active")},{default:o(()=>[a(ye,{modelValue:n.value.is_active,"onUpdate:modelValue":t[9]||(t[9]=l=>n.value.is_active=l)},null,8,["modelValue"])]),_:1},8,["label"]),J(m("input",{type:"hidden","onUpdate:modelValue":t[10]||(t[10]=l=>n.value.product_id=l)},null,512),[[G,n.value.product_id]]),J(m("input",{type:"hidden","onUpdate:modelValue":t[11]||(t[11]=l=>n.value.category_id=l)},null,512),[[G,n.value.category_id]]),a(y,{label:e.$t("Products.End-Date")},{default:o(()=>[a(W,{modelValue:n.value.end_date,"onUpdate:modelValue":t[12]||(t[12]=l=>n.value.end_date=l),type:"date",placeholder:e.$t("Products.Select-end-date"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"]),a(q,{modelValue:C.value,"onUpdate:modelValue":t[17]||(t[17]=l=>C.value=l),title:e.$t("Products.IncreaseInventory"),width:"500px"},{footer:o(()=>[a(r,{onClick:t[16]||(t[16]=l=>C.value=!1)},{default:o(()=>[g(i(e.$t("Products.cancel")),1)]),_:1}),a(r,{type:"primary",class:"mx-2",onClick:ue},{default:o(()=>[g(i(e.$t("Products.submit")),1)]),_:1})]),default:o(()=>[a(z,{model:I.value,"label-width":"140px"},{default:o(()=>[a(y,{label:e.$t("Products.Quantity")},{default:o(()=>[a(u,{modelValue:I.value.quantity,"onUpdate:modelValue":t[15]||(t[15]=l=>I.value.quantity=l),type:"number",placeholder:e.$t("Products.EnterQuantity")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Qe=he(Te,[["__scopeId","data-v-c935b9ff"]]);export{Qe as default};
