import{_ as de,D as ue,C as ie,y as _,L as O,E as ce,r,a5 as pe,o as g,c as B,a as n,t as d,e as l,p as o,G as U,b as p,U as m,j as k,a1 as me,a9 as _e,w as F,l as N,a6 as T,F as ve,d as fe,v as R,a4 as be}from"./index-50b21e1d.js";const ge={class:"products-container"},he={class:"header"},ye={class:"d-flex justify-content-between align-items-center w-100"},$e={class:"image-error"},Pe={key:1,class:"image-error"},we={dir:"rtl"},ke={class:"d-flex flex-column gap-1 align-items-center",dir:"ltr"},Ve={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},De=["onClick"],Ce=["onClick"],Ae=["onClick"],Ue={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},Se=["onClick"],Ee=["onClick"],Be={class:"dialog-footer"},h="https://massagebackend.webenia.org",Fe={__name:"index",setup(Ne){const S=ue(),{t:V}=ie(),y=_([]),$=_(!1),D=_(""),W=O(()=>{if(!D.value)return y.value;const e=D.value.toLowerCase();return y.value.filter(t=>t.name_en&&t.name_en.toLowerCase().includes(e)||t.name_ar&&t.name_ar.toLowerCase().includes(e))}),c=localStorage.getItem("lang")||"en",I=`${h}/api/dashboard/products`,j=async()=>{$.value=!0;try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await p.get(I);if(t.data.status)y.value=t.data.data;else throw new Error(t.data.message||"Failed to fetch products")}catch(e){console.error("Fetch products error:",e),m.error(c==="ar"?"فشل في تحميل المنتجات":"Failed to load products")}finally{$.value=!1}},q=()=>{S.push("/products/create")},G=e=>{S.push(`/products/${e}`)},Q=e=>{S.push(`/products/${e.id}/edit`)},Y=async e=>{try{if(await be.confirm(V("Products.DeleteConfirmation"),V("Products.Warning"),{confirmButtonText:V("Products.Yes"),cancelButtonText:V("Products.No"),type:"warning"})==="confirm"){$.value=!0;const i=JSON.parse(localStorage.getItem("tokenData"));if(!i||!i.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${i.token}`;const v=await p.delete(`${I}/${e.id}`);if(v.data.status)m.success(c==="ar"?"تم حذف المنتج بنجاح":"Product deleted successfully"),y.value=y.value.filter(C=>C.id!==e.id);else throw new Error(v.data.message||"Failed to delete product")}}catch(t){t!=="cancel"&&(console.error("Delete product error:",t),m.error(c==="ar"?"فشل في حذف المنتج":"Failed to delete product"))}finally{$.value=!1}},P=_(!1),E=_(null),L=_([]),u=_({unit_id:"",weight:"",price:""}),H=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await p.get(`${h}/api/units`);L.value=t.data.data}catch(e){console.error("Failed to fetch units:",e),m.error(c==="ar"?"فشل في تحميل الوحدات":"Failed to load units")}},K=e=>{E.value=e,u.value={unit_id:"",weight:"",price:""},H(),P.value=!0},X=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t={product_id:E.value.id,unit_id:u.value.unit_id,weight:u.value.weight,price:u.value.price};(await p.post(`${h}/api/amounts`,t)).data.status?(m.success(c==="ar"?"تم إضافة الكمية بنجاح":"Amount added successfully"),P.value=!1):m.error(c==="ar"?"فشل في إضافة الكمية":"Failed to add amount")}catch(e){console.error(e),m.error(c==="ar"?"حدث خطأ أثناء حفظ الكمية":"Error occurred while saving amount")}},w=_(!1),s=_({start_date:"",duration:"",discount_value:"",is_active:!1,product_id:"",category_id:"",end_date:""}),Z=e=>{E.value=e,s.value={start_date:"",duration:"",discount_value:"",is_active:!1,product_id:e.id,category_id:e.category_id||"",end_date:""},w.value=!0},x=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t={start_date:s.value.start_date,duration:s.value.duration,discount_value:s.value.discount_value,is_active:s.value.is_active,product_id:s.value.product_id,category_id:s.value.category_id,end_date:s.value.end_date};(await p.post(`${h}/api/discounts`,t)).data?(m.success(c==="ar"?"تم إضافة الخصم بنجاح":"Discount added successfully"),w.value=!1):m.error(c==="ar"?"فشل في إضافة الخصم":"Failed to add discount")}catch(e){console.error(e),m.error(c==="ar"?"حدث خطأ أثناء حفظ الخصم":"Error occurred while saving discount")}},ee=O(()=>window.innerWidth<=768);return ce(()=>{j()}),(e,t)=>{const i=r("el-button"),v=r("el-input"),C=r("el-icon"),te=r("el-image"),b=r("el-table-column"),ae=r("el-table"),le=r("el-card"),oe=r("el-option"),se=r("el-select"),f=r("el-form-item"),z=r("el-form"),J=r("el-dialog"),M=r("el-date-picker"),ne=r("el-switch"),re=pe("loading");return g(),B("div",ge,[n("div",he,[n("div",ye,[n("h2",null,d(e.$t("Products.Products")),1),l(i,{type:"primary",icon:U(me),onClick:q},{default:o(()=>[k(d(e.$t("Products.AddProduct")),1)]),_:1},8,["icon"])]),l(v,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=a=>D.value=a),placeholder:e.$t("Products.SearchPlaceholder"),"prefix-icon":U(_e),clearable:"",class:"search-input",style:{"max-width":"250px","margin-right":"16px"}},null,8,["modelValue","placeholder","prefix-icon"])]),l(le,{class:"products-table"},{default:o(()=>[F((g(),N(ae,{data:W.value,class:"table-responsivew",style:{height:"70vh"},dir:"ltr"},{default:o(()=>[l(b,{label:e.$t("Products.Image"),width:"120"},{default:o(({row:a})=>[a.images&&a.images.length>0?(g(),N(te,{key:0,src:h+"/public/storage/"+a.images[0].path,fit:"cover",class:"product-image","preview-src-list":[h+"/public/storage/"+a.images[0].path],"initial-index":0,"preview-teleported":""},{error:o(()=>[n("div",$e,[l(C,null,{default:o(()=>[l(U(T))]),_:1})])]),_:2},1032,["src","preview-src-list"])):(g(),B("div",Pe,[l(C,null,{default:o(()=>[l(U(T))]),_:1})]))]),_:1},8,["label"]),l(b,{prop:"name_en",label:e.$t("Products.NameEn")},null,8,["label"]),l(b,{prop:"name_ar",label:e.$t("Products.NameAr")},{default:o(({row:a})=>[n("div",we,d(a.name_ar||e.$t("Products.NA")),1)]),_:1},8,["label"]),l(b,{prop:"price",label:e.$t("Products.Price")},null,8,["label"]),l(b,{prop:"currency.name_en",label:e.$t("Products.Currency")},null,8,["label"]),l(b,{label:e.$t("Products.Actions"),width:"250"},{default:o(({row:a})=>[n("div",ke,[n("div",Ve,[n("button",{type:"button",class:"btn btn-success btn-sm",onClick:A=>G(a.id)},d(e.$t("Products.View")),9,De),n("button",{type:"button",class:"btn btn-warning btn-sm",onClick:A=>Q(a)},d(e.$t("Products.Edit")),9,Ce),n("button",{type:"button",class:"btn btn-danger btn-sm",onClick:A=>Y(a)},d(e.$t("Products.Delete")),9,Ae)]),n("div",Ue,[n("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:A=>K(a)},d(e.$t("Products.addAmount")),9,Se),n("button",{type:"button",class:"btn btn-info btn-sm",onClick:A=>Z(a)},d(e.$t("Products.addDiscount")),9,Ee)])])]),_:1},8,["label"])]),_:1},8,["data"])),[[re,$.value]])]),_:1}),l(J,{modelValue:P.value,"onUpdate:modelValue":t[5]||(t[5]=a=>P.value=a),title:e.$t("Products.AddAmount"),width:"500px"},{footer:o(()=>[l(i,{onClick:t[4]||(t[4]=a=>P.value=!1)},{default:o(()=>[k(d(e.$t("Products.cancel")),1)]),_:1}),l(i,{type:"primary",class:"mx-2",onClick:X},{default:o(()=>[k(d(e.$t("Products.submit")),1)]),_:1})]),default:o(()=>[l(z,{model:u.value,"label-width":"100px"},{default:o(()=>[l(f,{label:e.$t("Products.Unit")},{default:o(()=>[l(se,{modelValue:u.value.unit_id,"onUpdate:modelValue":t[1]||(t[1]=a=>u.value.unit_id=a),placeholder:e.$t("Products.select-unit")},{default:o(()=>[(g(!0),B(ve,null,fe(L.value,a=>(g(),N(oe,{key:a.id,label:a.name_en,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(f,{label:e.$t("Products.Weight")},{default:o(()=>[l(v,{modelValue:u.value.weight,"onUpdate:modelValue":t[2]||(t[2]=a=>u.value.weight=a),type:"number",placeholder:e.$t("Products.select-weight")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(f,{label:e.$t("Products.Price")},{default:o(()=>[l(v,{modelValue:u.value.price,"onUpdate:modelValue":t[3]||(t[3]=a=>u.value.price=a),type:"number",placeholder:e.$t("Products.select-price")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(J,{modelValue:w.value,"onUpdate:modelValue":t[14]||(t[14]=a=>w.value=a),title:e.$t("Products.addDiscount"),width:ee.value?"90%":"500px",class:"discount-dialog"},{footer:o(()=>[n("div",Be,[l(i,{onClick:t[13]||(t[13]=a=>w.value=!1)},{default:o(()=>[k(d(e.$t("Products.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:x},{default:o(()=>[k(d(e.$t("Products.submit")),1)]),_:1})])]),default:o(()=>[l(z,{model:s.value,"label-width":"100px",class:"discount-form"},{default:o(()=>[l(f,{label:e.$t("Products.Start-Date")},{default:o(()=>[l(M,{modelValue:s.value.start_date,"onUpdate:modelValue":t[6]||(t[6]=a=>s.value.start_date=a),type:"date",placeholder:e.$t("Products.Select-start-date"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(f,{label:e.$t("Products.Duration-days")},{default:o(()=>[l(v,{modelValue:s.value.duration,"onUpdate:modelValue":t[7]||(t[7]=a=>s.value.duration=a),type:"number",placeholder:e.$t("Products.Enter-duration-days"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(f,{label:e.$t("Products.Discount-Value")},{default:o(()=>[l(v,{modelValue:s.value.discount_value,"onUpdate:modelValue":t[8]||(t[8]=a=>s.value.discount_value=a),type:"number",placeholder:e.$t("Products.Enter-discount-percentage"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(f,{label:e.$t("Products.Is-Active")},{default:o(()=>[l(ne,{modelValue:s.value.is_active,"onUpdate:modelValue":t[9]||(t[9]=a=>s.value.is_active=a)},null,8,["modelValue"])]),_:1},8,["label"]),F(n("input",{type:"hidden","onUpdate:modelValue":t[10]||(t[10]=a=>s.value.product_id=a)},null,512),[[R,s.value.product_id]]),F(n("input",{type:"hidden","onUpdate:modelValue":t[11]||(t[11]=a=>s.value.category_id=a)},null,512),[[R,s.value.category_id]]),l(f,{label:e.$t("Products.End-Date")},{default:o(()=>[l(M,{modelValue:s.value.end_date,"onUpdate:modelValue":t[12]||(t[12]=a=>s.value.end_date=a),type:"date",placeholder:e.$t("Products.Select-end-date"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])])}}},Le=de(Fe,[["__scopeId","data-v-b403c899"]]);export{Le as default};
