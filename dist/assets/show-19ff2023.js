import{_ as ie,Z as ue,e as m,B as I,f as ce,r as w,o,c as u,m as F,w as $,b as P,a as r,t as n,h as b,E as de,F as k,k as S,K as pe,I as ge,j as i,i as g}from"./index-0e709365.js";const ve={class:"product-detail-container"},_e={class:"product-title"},me={class:"images"},fe=["src"],ye={key:1,class:"image-error"},he={class:"info"},$e={key:0},be={key:1},ke={dir:"rtl"},Pe={key:2,class:"image-preview-list",style:{"margin-bottom":"1em"}},Ae=["src"],Ie={class:"attribute-display-container"},Ne={class:"attribute-name-icon"},De=["innerHTML"],we={class:"attribute-value"},Se={key:0},Ce={key:1},Le={class:"main-ingredient-display-container"},Fe=["src"],Me={key:1,class:"loading-container"},f="https://backend.msgperfumes.com",Re={__name:"show",setup(Ee){const H=ue(),t=m({}),C=m(!1),L=m(null),M=m([]),G=m([]),T=m([]),W=I(()=>T.value.filter(e=>!e.is_deleted)),R=m([]),q=m([]),z=m([]),U=m([]),J=m([]),V=e=>e?typeof e=="object"&&e.url?e.url:e.startsWith("http")?e:`${f}/public/storage/${e}`:"",K=e=>{const a=localStorage.getItem("lang")||"en";return e?a==="ar"?e.name_ar||e.name_en||"":e.name_en||e.name_ar||"":""},Q=e=>{const a=localStorage.getItem("lang")||"en";return e?a==="ar"?e.name_ar||e.name_en||"":e.name_en||e.name_ar||"":""},Z=e=>{const a=localStorage.getItem("lang")||"en";return e?a==="ar"?e.name_ar||e.name_en||"":e.name_en||e.name_ar||"":""},X=e=>{const a=localStorage.getItem("lang")||"en";return e?a==="ar"?e.description_ar||e.description_en||"":e.description_en||e.description_ar||"":""},Y=e=>{const a=z.value.find(c=>c.id===e);return a?(localStorage.getItem("lang")||"en")==="ar"?a.name_ar:a.name_en:""},E=e=>U.value.find(a=>a.id===e),x=(e,a)=>{if(!e)return"";let s=e;const c=s.match(/<defs[^>]*>([\s\S]*?)<\/defs>/);let y=c?c[1]:"";const v=typeof a=="string"&&a.includes("%"),N=v?parseFloat(a.replace("%","")):null;if(v&&N!==null&&!isNaN(N)){const A=Math.max(0,Math.min(1,N/100)),h=y.match(/<linearGradient id="(g[0-9]+)"[^>]*>([\s\S]*?)<\/linearGradient>/);if(h){const l=h[1];let d=h[2];d=d.replace(/<stop offset="[^"]*"([^>]*)>/g,()=>`<stop offset="${A}" stop-color="#78D6F0"/><stop offset="${A}" stop-color="#8D8D8D" stop-opacity="0.2"/>`);const p=`<linearGradient id="${l}"${h[0].split(l)[1].split(">")[0]}>${d}</linearGradient>`;y=y.replace(h[0],p),s.includes('fill="')&&!s.includes(`fill="url(#${l})"`)&&(s=s.replace(/fill="[^"]*"/g,`fill="url(#${l})"`)),s.includes('stroke="')&&!s.includes(`stroke="url(#${l})"`)&&(s=s.replace(/stroke="[^"]*"/g,`stroke="url(#${l})" stroke-width="2"`))}else{const l=`gradient-${Math.random().toString(36).substr(2,9)}`,d=`
      <linearGradient id="${l}" x1="0%" y1="100%" x2="0%" y2="0%" gradientUnits="userSpaceOnUse">
        <stop offset="${A}" stop-color="#78D6F0"/>
        <stop offset="${A}" stop-color="#8D8D8D" stop-opacity="0.2"/>
      </linearGradient>
    `;y+=d,s.includes('fill="')&&(s=s.replace(/fill="[^"]*"/g,`fill="url(#${l})"`)),s.includes('stroke="')&&(s=s.replace(/stroke="[^"]*"/g,`stroke="url(#${l})" stroke-width="2"`))}if(c)s=s.replace(c[0],`<defs>${y}</defs>`);else{const l=s.match(/<svg[^>]*>/);l&&(s=s.replace(l[0],`${l[0]}<defs>${y}</defs>`))}}const D=s.lastIndexOf("</svg>");return D!==-1&&a?s.substring(0,D)+`<text x="50%" y="50%" font-size="16" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#333333" stroke="white" stroke-width="1">${a}</text>`+s.substring(D):s},ee=I(()=>{const e=localStorage.getItem("lang")||"en";if(t.value.brand)return e==="ar"?t.value.brand.name_ar||t.value.brand.name_en||"N/A":t.value.brand.name_en||t.value.brand.name_ar||"N/A";const a=M.value.find(s=>s.id===t.value.brand_id);return a?e==="ar"?a.name_ar:a.name_en:"N/A"}),te=I(()=>{const e=localStorage.getItem("lang")||"en";let a=G.value.find(s=>s.id===t.value.category_id);return!a&&t.value.parent&&t.value.parent.category&&(a=t.value.parent.category),a?e==="ar"?a.name_ar||a.name_en:a.name_en||a.name_ar:"N/A"}),j=I(()=>{const e=localStorage.getItem("lang")||"en";let a=W.value.find(s=>s.id===t.value.currency_id);return!a&&t.value.parent&&t.value.parent.currency&&(a=t.value.parent.currency),a?e==="ar"?a.name_ar||a.name_en:a.name_en||a.name_ar:"N/A"}),ae=I(()=>{const e=localStorage.getItem("lang")||"en";let a=R.value.find(s=>s.id===t.value.country_id);return!a&&t.value.parent&&t.value.parent.country_id&&(a=R.value.find(s=>s.id===t.value.parent.country_id)),a?e==="ar"?a.name_ar||a.name_en:a.name_en||a.name_ar:"N/A"}),ne=I(()=>{const e=t.value.parent;return e?(localStorage.getItem("lang")||"en")==="ar"?e.name_ar||e.name_en:e.name_en||e.name_ar:"None"}),O=I(()=>{let e=M.value.find(a=>a.id===t.value.brand_id);return!e&&t.value.parent&&t.value.parent.brand&&(e=t.value.parent.brand),e&&e.images&&e.images.length>0?V(e.images[0].path):null}),re=`${f}/api/products`,le=async()=>{var e;C.value=!0;try{const a=JSON.parse(localStorage.getItem("tokenData"));if(!a||!a.token)throw new Error("Authentication token not found");b.defaults.headers.common.Authorization=`Bearer ${a.token}`;const{id:s}=H.params,[c,y,v,N,D,A,h,l,d]=await Promise.all([b.get(`${re}/${s}`),b.get(`${f}/api/categories`),b.get(`${f}/api/website/currencies`),b.get(`${f}/api/countries`),b.get(`${f}/api/brands`),b.get(`${f}/api/units`),b.get(`${f}/api/attributes`),b.get(`${f}/api/main-ingredients`),b.get(`${f}/api/products`)]);if(G.value=y.data.data,T.value=v.data.data,R.value=N.data.data,M.value=D.data.data.map(p=>({...p,logo_path:p.images&&p.images.length>0?p.images[0].path:null})),z.value=A.data.data,U.value=h.data.data||[],J.value=Array.isArray(l.data)?l.data:((e=l.data)==null?void 0:e.data)||[],q.value=d.data.data,c.data.status){t.value=c.data.data,Array.isArray(t.value.amounts)&&(t.value.amounts=t.value.amounts.map(_=>({..._,unit_id:_.unit&&_.unit.id!=null?Number(_.unit.id):_.unit_id!=null?Number(_.unit_id):null}))),t.value.discount&&(t.value.discount={id:t.value.discount.id??null,value:parseFloat(t.value.discount.discount_value??t.value.discount.value??0),startDate:(t.value.discount.start_date||t.value.discount.startDate||"").toString().split("T")[0]||null,endDate:(t.value.discount.end_date||t.value.discount.endDate||"").toString().split("T")[0]||null,is_active:!!t.value.discount.is_active});let p=[];if(Array.isArray(t.value.attributes)&&(p=p.concat(t.value.attributes)),t.value.parent&&Array.isArray(t.value.parent.attributes_with_values)){const _=new Set(p.map(B=>B.id)),oe=t.value.parent.attributes_with_values.filter(B=>!_.has(B.id));p=p.concat(oe)}t.value.all_attributes=p,t.value.attribute_values_map={},p.forEach(_=>{t.value.attribute_values_map[_.id]=_.value})}else throw new Error(c.data.message||"Failed to fetch product")}catch(a){console.error("Fetch product error:",a),L.value=a.message||"Failed to fetch product",de.error(L.value)}finally{C.value=!1}};ce(()=>{le()});const se=I(()=>{var a;return(Array.isArray((a=t.value)==null?void 0:a.inventory_items)?t.value.inventory_items:[]).reduce((s,c)=>s+(Number(c==null?void 0:c.quantity)||0),0)});return(e,a)=>{const s=w("el-carousel-item"),c=w("el-carousel"),y=w("el-icon"),v=w("el-divider"),N=w("el-card"),D=w("el-spinner"),A=w("el-alert");return o(),u("div",ve,[!C.value&&!L.value?(o(),F(N,{key:0,class:"product-card"},{default:$(()=>{var h;return[r("h2",_e,n(t.value.name_en),1),r("div",me,[t.value.images&&t.value.images.length>0?(o(),F(c,{key:0,height:"300px",arrow:"always"},{default:$(()=>[(o(!0),u(k,null,S(t.value.images,l=>(o(),F(s,{key:l.id},{default:$(()=>[r("img",{src:`${f}/public/storage/${l.path}`,class:"product-image",alt:"Product Image"},null,8,fe)]),_:2},1024))),128))]),_:1})):(o(),u("div",ye,[P(y,null,{default:$(()=>[P(pe(ge))]),_:1}),r("p",null,n(e.$t("Products.NoImageAvailable")),1)]))]),r("div",he,[r("p",null,[r("strong",null,n(e.$t("Products.Price"))+":",1),i(" "+n(t.value.price)+" "+n(((h=t.value.currency)==null?void 0:h.name_en)||""),1)]),t.value.converted_price!=null?(o(),u("p",$e,[r("strong",null,n(e.$t("Products.ConvertedPrice"))+":",1),i(" "+n(t.value.converted_price),1)])):g("",!0),t.value.discounted_price!=null?(o(),u("p",be,[r("strong",null,n(e.$t("Products.DiscountedPrice"))+":",1),i(" "+n(t.value.discounted_price),1)])):g("",!0),r("p",null,[r("strong",null,n(e.$t("Products.Quantity"))+":",1),i(" "+n(se.value),1)]),r("p",null,[r("strong",null,n(e.$t("Products.Availability"))+":",1),i(" "+n(t.value.is_available?e.$t("Products.Available"):e.$t("Products.NotAvailable")),1)]),r("p",null,[r("strong",null,n(e.$t("Products.DescriptionEn"))+":",1),i(" "+n(t.value.description_en||e.$t("Products.NA")),1)]),r("p",null,[r("strong",null,n(e.$t("Products.DescriptionAr"))+":",1),a[0]||(a[0]=i()),r("span",ke,n(t.value.description_ar||e.$t("Products.NA")),1)]),P(v,{"content-position":"left"},{default:$(()=>[i(n(e.$t("Products.Details")),1)]),_:1}),r("p",null,[r("strong",null,n(e.$t("Products.Category"))+":",1),i(" "+n(te.value),1)]),r("p",null,[r("strong",null,n(e.$t("Products.brand"))+":",1),i(" "+n(ee.value),1)]),O.value?(o(),u("div",Pe,[r("img",{src:O.value,alt:"Brand Image",style:{"max-width":"120px","max-height":"120px","margin-right":"10px","border-radius":"8px"}},null,8,Ae)])):g("",!0),r("p",null,[r("strong",null,n(e.$t("Products.Currency"))+":",1),i(" "+n(j.value),1)]),r("p",null,[r("strong",null,n(e.$t("Products.Country"))+":",1),i(" "+n(ae.value),1)]),r("p",null,[r("strong",null,n(e.$t("Products.ParentProduct"))+":",1),i(" "+n(ne.value),1)]),t.value.all_attributes&&t.value.all_attributes.length>0?(o(),u(k,{key:3},[P(v,{"content-position":"left"},{default:$(()=>[i(n(e.$t("Products.Attributes")),1)]),_:1}),r("div",Ie,[(o(!0),u(k,null,S(t.value.all_attributes,l=>{var d;return o(),u("div",{key:l.id,class:"attribute-display-item"},[r("div",Ne,[(d=E(l.id))!=null&&d.icon?(o(),u("div",{key:0,class:"attribute-icon",innerHTML:x(E(l.id).icon,t.value.attribute_values_map[l.id])},null,8,De)):g("",!0),r("span",null,n(K(E(l.id))),1)]),r("span",we,n(t.value.attribute_values_map[l.id]),1)])}),128))])],64)):g("",!0),t.value.amounts&&t.value.amounts.length>0?(o(),u(k,{key:4},[P(v,{"content-position":"left"},{default:$(()=>[i(n(e.$t("Products.Amounts")),1)]),_:1}),(o(!0),u(k,null,S(t.value.amounts,(l,d)=>(o(),u("div",{key:d,class:"amount-display-item"},[r("p",null,[r("strong",null,n(e.$t("Products.Unit"))+":",1),i(" "+n(Y(l.unit_id)),1)]),r("p",null,[r("strong",null,n(e.$t("Products.Weight"))+":",1),i(" "+n(l.weight),1)]),r("p",null,[r("strong",null,n(e.$t("Products.amount-Price"))+":",1),i(" "+n(l.price)+" "+n(j.value),1)]),l.converted_price!=null?(o(),u("p",Se,[r("strong",null,n(e.$t("Products.ConvertedPrice"))+":",1),i(" "+n(l.converted_price),1)])):g("",!0),l.discounted_price!=null?(o(),u("p",Ce,[r("strong",null,n(e.$t("Products.DiscountedPrice"))+":",1),i(" "+n(l.discounted_price),1)])):g("",!0)]))),128))],64)):g("",!0),t.value.main_ingredients&&t.value.main_ingredients.length>0?(o(),u(k,{key:5},[P(v,{"content-position":"left"},{default:$(()=>[i(n(e.$t("Products.MainIngredients")),1)]),_:1}),r("div",Le,[(o(!0),u(k,null,S(t.value.main_ingredients,(l,d)=>(o(),u("div",{key:d,class:"main-ingredient-item"},[l.images&&l.images.length>0?(o(),u("img",{key:0,src:V(l.images[0].path),alt:"Main Ingredient Image",class:"main-ingredient-image"},null,8,Fe)):g("",!0),r("span",null,n(Q(l)),1)]))),128))])],64)):g("",!0),t.value.fragrance_notes&&t.value.fragrance_notes.length>0?(o(),u(k,{key:6},[P(v,{"content-position":"left"},{default:$(()=>[i(n(e.$t("Products.FragranceNotes")),1)]),_:1}),(o(!0),u(k,null,S(t.value.fragrance_notes,(l,d)=>(o(),u("div",{key:d,class:"fragrance-note-display-item"},[r("p",null,[r("strong",null,n(e.$t("Products.NameEn"))+":",1),i(" "+n(Z(l)),1)]),r("p",null,[r("strong",null,n(e.$t("Products.DescriptionEn"))+":",1),i(" "+n(X(l)),1)])]))),128))],64)):g("",!0),t.value.discount&&t.value.discount.is_active?(o(),u(k,{key:7},[P(v,{"content-position":"left"},{default:$(()=>[i(n(e.$t("Products.discountInfo")),1)]),_:1}),r("p",null,[r("strong",null,n(e.$t("Products.Discount-Value"))+":",1),i(" "+n(t.value.discount.value)+"%",1)]),r("p",null,[r("strong",null,n(e.$t("Products.Start-Date"))+":",1),i(" "+n(t.value.discount.startDate),1)]),r("p",null,[r("strong",null,n(e.$t("Products.End-Date"))+":",1),i(" "+n(t.value.discount.endDate),1)])],64)):g("",!0)])]}),_:1})):C.value?(o(),u("div",Me,[P(D,{type:"snake"}),r("p",null,n(e.$t("Products.Loading")),1)])):(o(),F(A,{key:2,title:L.value,type:"error","show-icon":""},null,8,["title"]))])}}},Ge=ie(Re,[["__scopeId","data-v-1d6bb754"]]);export{Ge as default};
