import{_ as ie,Z as ue,e as m,B as P,f as ce,r as w,o,c as u,m as M,w as y,b,a as n,t as r,h,E as de,F as $,k as D,K as ge,I as pe,j as i,i as A}from"./index-d33f2148.js";const me={class:"product-detail-container"},_e={class:"product-title"},ve={class:"images"},fe=["src"],ye={key:1,class:"image-error"},he={class:"info"},$e={dir:"rtl"},be={key:0,class:"image-preview-list",style:{"margin-bottom":"1em"}},ke=["src"],Pe={class:"attribute-display-container"},Ae={class:"attribute-name-icon"},Ie=["innerHTML"],Ne={class:"attribute-value"},we={class:"main-ingredient-display-container"},De=["src"],Se={key:1,class:"loading-container"},_="https://massagebackend.webenia.org",Le={__name:"show",setup(Ce){const H=ue(),a=m({}),S=m(!1),L=m(null),R=m([]),G=m([]),z=m([]),W=P(()=>z.value.filter(e=>!e.is_deleted)),E=m([]),q=m([]),U=m([]),V=m([]),J=m([]),T=e=>e?typeof e=="object"&&e.url?e.url:e.startsWith("http")?e:`${_}/public/storage/${e}`:"",K=e=>{const t=localStorage.getItem("lang")||"en";return e?t==="ar"?e.name_ar||e.name_en||"":e.name_en||e.name_ar||"":""},Q=e=>{const t=localStorage.getItem("lang")||"en";return e?t==="ar"?e.name_ar||e.name_en||"":e.name_en||e.name_ar||"":""},Z=e=>{const t=localStorage.getItem("lang")||"en";return e?t==="ar"?e.name_ar||e.name_en||"":e.name_en||e.name_ar||"":""},X=e=>{const t=localStorage.getItem("lang")||"en";return e?t==="ar"?e.description_ar||e.description_en||"":e.description_en||e.description_ar||"":""},Y=e=>{const t=U.value.find(c=>c.id===e);return t?(localStorage.getItem("lang")||"en")==="ar"?t.name_ar:t.name_en:""},F=e=>V.value.find(t=>t.id===e),x=(e,t)=>{if(!e)return"";let l=e;const c=l.match(/<defs[^>]*>([\s\S]*?)<\/defs>/);let v=c?c[1]:"";const p=typeof t=="string"&&t.includes("%"),I=p?parseFloat(t.replace("%","")):null;if(p&&I!==null&&!isNaN(I)){const k=Math.max(0,Math.min(1,I/100)),f=v.match(/<linearGradient id="(g[0-9]+)"[^>]*>([\s\S]*?)<\/linearGradient>/);if(f){const s=f[1];let d=f[2];d=d.replace(/<stop offset="[^"]*"([^>]*)>/g,()=>`<stop offset="${k}" stop-color="#78D6F0"/><stop offset="${k}" stop-color="#8D8D8D" stop-opacity="0.2"/>`);const g=`<linearGradient id="${s}"${f[0].split(s)[1].split(">")[0]}>${d}</linearGradient>`;v=v.replace(f[0],g),l.includes('fill="')&&!l.includes(`fill="url(#${s})"`)&&(l=l.replace(/fill="[^"]*"/g,`fill="url(#${s})"`)),l.includes('stroke="')&&!l.includes(`stroke="url(#${s})"`)&&(l=l.replace(/stroke="[^"]*"/g,`stroke="url(#${s})" stroke-width="2"`))}else{const s=`gradient-${Math.random().toString(36).substr(2,9)}`,d=`
      <linearGradient id="${s}" x1="0%" y1="100%" x2="0%" y2="0%" gradientUnits="userSpaceOnUse">
        <stop offset="${k}" stop-color="#78D6F0"/>
        <stop offset="${k}" stop-color="#8D8D8D" stop-opacity="0.2"/>
      </linearGradient>
    `;v+=d,l.includes('fill="')&&(l=l.replace(/fill="[^"]*"/g,`fill="url(#${s})"`)),l.includes('stroke="')&&(l=l.replace(/stroke="[^"]*"/g,`stroke="url(#${s})" stroke-width="2"`))}if(c)l=l.replace(c[0],`<defs>${v}</defs>`);else{const s=l.match(/<svg[^>]*>/);s&&(l=l.replace(s[0],`${s[0]}<defs>${v}</defs>`))}}const N=l.lastIndexOf("</svg>");return N!==-1&&t?l.substring(0,N)+`<text x="50%" y="50%" font-size="16" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#333333" stroke="white" stroke-width="1">${t}</text>`+l.substring(N):l},ee=P(()=>{const e=localStorage.getItem("lang")||"en";if(a.value.brand)return e==="ar"?a.value.brand.name_ar||a.value.brand.name_en||"N/A":a.value.brand.name_en||a.value.brand.name_ar||"N/A";const t=R.value.find(l=>l.id===a.value.brand_id);return t?e==="ar"?t.name_ar:t.name_en:"N/A"}),te=P(()=>{const e=localStorage.getItem("lang")||"en";let t=G.value.find(l=>l.id===a.value.category_id);return!t&&a.value.parent&&a.value.parent.category&&(t=a.value.parent.category),t?e==="ar"?t.name_ar||t.name_en:t.name_en||t.name_ar:"N/A"}),j=P(()=>{const e=localStorage.getItem("lang")||"en";let t=W.value.find(l=>l.id===a.value.currency_id);return!t&&a.value.parent&&a.value.parent.currency&&(t=a.value.parent.currency),t?e==="ar"?t.name_ar||t.name_en:t.name_en||t.name_ar:"N/A"}),ae=P(()=>{const e=localStorage.getItem("lang")||"en";let t=E.value.find(l=>l.id===a.value.country_id);return!t&&a.value.parent&&a.value.parent.country_id&&(t=E.value.find(l=>l.id===a.value.parent.country_id)),t?e==="ar"?t.name_ar||t.name_en:t.name_en||t.name_ar:"N/A"}),ne=P(()=>{const e=a.value.parent;return e?(localStorage.getItem("lang")||"en")==="ar"?e.name_ar||e.name_en:e.name_en||e.name_ar:"None"}),O=P(()=>{let e=R.value.find(t=>t.id===a.value.brand_id);return!e&&a.value.parent&&a.value.parent.brand&&(e=a.value.parent.brand),e&&e.images&&e.images.length>0?T(e.images[0].path):null}),re=`${_}/api/products`,le=async()=>{var e;S.value=!0;try{const t=JSON.parse(localStorage.getItem("tokenData"));if(!t||!t.token)throw new Error("Authentication token not found");h.defaults.headers.common.Authorization=`Bearer ${t.token}`;const{id:l}=H.params,[c,v,p,I,N,k,f,s,d]=await Promise.all([h.get(`${re}/${l}`),h.get(`${_}/api/categories`),h.get(`${_}/api/website/currencies`),h.get(`${_}/api/countries`),h.get(`${_}/api/brands`),h.get(`${_}/api/units`),h.get(`${_}/api/attributes`),h.get(`${_}/api/main-ingredients`),h.get(`${_}/api/products`)]);if(G.value=v.data.data,z.value=p.data.data,E.value=I.data.data,R.value=N.data.data.map(g=>({...g,logo_path:g.images&&g.images.length>0?g.images[0].path:null})),U.value=k.data.data,V.value=f.data.data||[],J.value=Array.isArray(s.data)?s.data:((e=s.data)==null?void 0:e.data)||[],q.value=d.data.data,c.data.status){a.value=c.data.data;let g=[];if(Array.isArray(a.value.attributes)&&(g=g.concat(a.value.attributes)),a.value.parent&&Array.isArray(a.value.parent.attributes_with_values)){const C=new Set(g.map(B=>B.id)),oe=a.value.parent.attributes_with_values.filter(B=>!C.has(B.id));g=g.concat(oe)}a.value.all_attributes=g,a.value.attribute_values_map={},g.forEach(C=>{a.value.attribute_values_map[C.id]=C.value})}else throw new Error(c.data.message||"Failed to fetch product")}catch(t){console.error("Fetch product error:",t),L.value=t.message||"Failed to fetch product",de.error(L.value)}finally{S.value=!1}};ce(()=>{le()});const se=P(()=>{var t;return(Array.isArray((t=a.value)==null?void 0:t.inventory_items)?a.value.inventory_items:[]).reduce((l,c)=>l+(Number(c==null?void 0:c.quantity)||0),0)});return(e,t)=>{const l=w("el-carousel-item"),c=w("el-carousel"),v=w("el-icon"),p=w("el-divider"),I=w("el-card"),N=w("el-spinner"),k=w("el-alert");return o(),u("div",me,[!S.value&&!L.value?(o(),M(I,{key:0,class:"product-card"},{default:y(()=>{var f;return[n("h2",_e,r(a.value.name_en),1),n("div",ve,[a.value.images&&a.value.images.length>0?(o(),M(c,{key:0,height:"300px",arrow:"always"},{default:y(()=>[(o(!0),u($,null,D(a.value.images,s=>(o(),M(l,{key:s.id},{default:y(()=>[n("img",{src:`${_}/public/storage/${s.path}`,class:"product-image",alt:"Product Image"},null,8,fe)]),_:2},1024))),128))]),_:1})):(o(),u("div",ye,[b(v,null,{default:y(()=>[b(ge(pe))]),_:1}),n("p",null,r(e.$t("Products.NoImageAvailable")),1)]))]),n("div",he,[n("p",null,[n("strong",null,r(e.$t("Products.Price"))+":",1),i(" "+r(a.value.price)+" "+r(((f=a.value.currency)==null?void 0:f.name_en)||""),1)]),n("p",null,[n("strong",null,r(e.$t("Products.Quantity"))+":",1),i(" "+r(se.value),1)]),n("p",null,[n("strong",null,r(e.$t("Products.Availability"))+":",1),i(" "+r(a.value.is_available?e.$t("Products.Available"):e.$t("Products.NotAvailable")),1)]),n("p",null,[n("strong",null,r(e.$t("Products.DescriptionEn"))+":",1),i(" "+r(a.value.description_en||e.$t("Products.NA")),1)]),n("p",null,[n("strong",null,r(e.$t("Products.DescriptionAr"))+":",1),t[0]||(t[0]=i()),n("span",$e,r(a.value.description_ar||e.$t("Products.NA")),1)]),b(p,{"content-position":"left"},{default:y(()=>[i(r(e.$t("Products.Details")),1)]),_:1}),n("p",null,[n("strong",null,r(e.$t("Products.Category"))+":",1),i(" "+r(te.value),1)]),n("p",null,[n("strong",null,r(e.$t("Products.brand"))+":",1),i(" "+r(ee.value),1)]),O.value?(o(),u("div",be,[n("img",{src:O.value,alt:"Brand Image",style:{"max-width":"120px","max-height":"120px","margin-right":"10px","border-radius":"8px"}},null,8,ke)])):A("",!0),n("p",null,[n("strong",null,r(e.$t("Products.Currency"))+":",1),i(" "+r(j.value),1)]),n("p",null,[n("strong",null,r(e.$t("Products.Country"))+":",1),i(" "+r(ae.value),1)]),n("p",null,[n("strong",null,r(e.$t("Products.ParentProduct"))+":",1),i(" "+r(ne.value),1)]),a.value.all_attributes&&a.value.all_attributes.length>0?(o(),u($,{key:1},[b(p,{"content-position":"left"},{default:y(()=>[i(r(e.$t("Products.Attributes")),1)]),_:1}),n("div",Pe,[(o(!0),u($,null,D(a.value.all_attributes,s=>{var d;return o(),u("div",{key:s.id,class:"attribute-display-item"},[n("div",Ae,[(d=F(s.id))!=null&&d.icon?(o(),u("div",{key:0,class:"attribute-icon",innerHTML:x(F(s.id).icon,a.value.attribute_values_map[s.id])},null,8,Ie)):A("",!0),n("span",null,r(K(F(s.id))),1)]),n("span",Ne,r(a.value.attribute_values_map[s.id]),1)])}),128))])],64)):A("",!0),a.value.amounts&&a.value.amounts.length>0?(o(),u($,{key:2},[b(p,{"content-position":"left"},{default:y(()=>[i(r(e.$t("Products.Amounts")),1)]),_:1}),(o(!0),u($,null,D(a.value.amounts,(s,d)=>(o(),u("div",{key:d,class:"amount-display-item"},[n("p",null,[n("strong",null,r(e.$t("Products.Unit"))+":",1),i(" "+r(Y(s.unit_id)),1)]),n("p",null,[n("strong",null,r(e.$t("Products.Weight"))+":",1),i(" "+r(s.weight),1)]),n("p",null,[n("strong",null,r(e.$t("Products.amount-Price"))+":",1),i(" "+r(s.price)+" "+r(j.value),1)])]))),128))],64)):A("",!0),a.value.main_ingredients&&a.value.main_ingredients.length>0?(o(),u($,{key:3},[b(p,{"content-position":"left"},{default:y(()=>[i(r(e.$t("Products.MainIngredients")),1)]),_:1}),n("div",we,[(o(!0),u($,null,D(a.value.main_ingredients,(s,d)=>(o(),u("div",{key:d,class:"main-ingredient-item"},[s.images&&s.images.length>0?(o(),u("img",{key:0,src:T(s.images[0].path),alt:"Main Ingredient Image",class:"main-ingredient-image"},null,8,De)):A("",!0),n("span",null,r(Q(s)),1)]))),128))])],64)):A("",!0),a.value.fragrance_notes&&a.value.fragrance_notes.length>0?(o(),u($,{key:4},[b(p,{"content-position":"left"},{default:y(()=>[i(r(e.$t("Products.FragranceNotes")),1)]),_:1}),(o(!0),u($,null,D(a.value.fragrance_notes,(s,d)=>(o(),u("div",{key:d,class:"fragrance-note-display-item"},[n("p",null,[n("strong",null,r(e.$t("Products.NameEn"))+":",1),i(" "+r(Z(s)),1)]),n("p",null,[n("strong",null,r(e.$t("Products.DescriptionEn"))+":",1),i(" "+r(X(s)),1)])]))),128))],64)):A("",!0),a.value.discount&&a.value.discount.is_active?(o(),u($,{key:5},[b(p,{"content-position":"left"},{default:y(()=>[i(r(e.$t("Products.discountInfo")),1)]),_:1}),n("p",null,[n("strong",null,r(e.$t("Products.Discount-Value"))+":",1),i(" "+r(a.value.discount.value)+"%",1)]),n("p",null,[n("strong",null,r(e.$t("Products.Start-Date"))+":",1),i(" "+r(a.value.discount.startDate),1)]),n("p",null,[n("strong",null,r(e.$t("Products.End-Date"))+":",1),i(" "+r(a.value.discount.endDate),1)])],64)):A("",!0)])]}),_:1})):S.value?(o(),u("div",Se,[b(N,{type:"snake"}),n("p",null,r(e.$t("Products.Loading")),1)])):(o(),M(k,{key:2,title:L.value,type:"error","show-icon":""},null,8,["title"]))])}}},Re=ie(Le,[["__scopeId","data-v-5694fc68"]]);export{Re as default};
