import{_ as he,C as ke,L as S,M as ye,D as be,z as we,B as Ce,y as k,E as Fe,x as D,N as Se,O as $e,r as E,o as r,c,e as _,a as i,p as C,t as l,G as M,F as $,d as T,f,b as X,H as xe,n as x,j as oe,w as Ie,v as ze,k as Te,I as g}from"./index-50b21e1d.js";import{$ as b}from"./slick-theme-ced8f1f2.js";const qe=["dir"],Pe={class:"container"},Ee={class:"product-details"},Ne={class:"product-title"},Ae={key:0,class:"description"},Ve={class:"price-block"},Be={class:"d-flex"},Le={key:0,class:"price-old",dir:"ltr"},Ue={key:1,class:"discount-badge",dir:"ltr"},De={class:"price-new",dir:"ltr"},Me=["title"],Oe={class:"product-actions"},Re={key:0,class:"sale-badge"},Qe={key:1,class:"weight"},He={class:"weight-title"},Je={class:"weight-container"},je={class:"row g-4"},Ge=["onClick"],Ke={key:0,class:"amount-details",style:{"margin-top":"1rem"}},We={key:1},Xe={class:"buttons-section"},Ye={key:0,class:"quantity-section"},Ze={class:"quantity-control"},et=["src"],tt={class:"slider-wrapper"},st=["onClick"],at=["src"],ot={key:0,class:"children-products-section"},it={class:"title section-header d-flex align-items-center mb-4"},nt={class:"mb-0"},rt={class:"row g-3"},ct={class:"product-card card border-0 h-100"},lt={class:"position-relative overflow-hidden bg-light"},dt=["src","alt"],ut={key:0,class:"sale-badge"},vt={class:"product-actions d-flex justify-content-center gap-2 w-100"},_t=["onClick","disabled"],pt=["onClick","disabled"],mt=["onClick","title"],gt={class:"card-body"},ft={class:"card-title"},ht={class:"price-container"},kt={key:0,class:"discount-badge"},yt={key:1,class:"price-old",dir:"ltr"},bt={class:"card-text card-price",dir:"ltr"},ie=1,ne=99,Y="/default-image.jpg",wt={__name:"showProduct",setup(Ct){const{locale:F,t:d}=ke(),O=S(()=>F.value==="ar"?"rtl":"ltr"),Z=ye();be();const y=we(),N=Ce(),s=k({}),h=k(1),A=k(null);k(0),k("");const I=k(null),q=k(null),R=k(3),Q=k(3),P=e=>y.favorites.some(t=>t.product_id===e),re=e=>{var t,o;return((t=y.favorites.find(n=>n.product_id===e))==null?void 0:t.favorite_id)||((o=y.favorites.find(n=>n.product_id===e))==null?void 0:o.id)},ce=async e=>{var t,o;try{if(P(e.id)){const n=re(e.id);n&&(await y.removeFromFavorites(n),g({title:d("success"),message:d("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const n=await y.addToFavorites(e.id);g({title:d("success"),message:n.message||d("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){console.error("Favorite error:",n),g({title:d("error"),message:((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||d("login_required_favorite")||"Login required to favorite product",type:"error"})}},le=async()=>{var e,t,o,n,v;try{let u=0;if(p.value?u=parseFloat((e=p.value)==null?void 0:e.price):u=parseFloat(s.value.price),s.value.discount&&s.value.discount.is_active){const m=parseFloat(s.value.discount.discount_value);u=u-u*(m/100)}const w={product_id:s.value.id,quantity:h.value,price:u};p.value&&(w.amount_id=p.value.id);const a=await X.post("https://massagebackend.webenia.org/api/cart-items",w,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.status?(g({title:d("success"),message:d("Products.addedSussess"),type:"success"}),N.incrementCount(),await N.fetchCartCount()):g.error(a.data.message)}catch(u){if(((o=(t=u.response)==null?void 0:t.data)==null?void 0:o.message)==="Unauthenticated."){g({title:d("error"),message:d("unauthenticated"),type:"warning",duration:4e3});return}g({title:d("error"),message:(v=(n=u.response)==null?void 0:n.data)==null?void 0:v.message,type:"error"})}},V=e=>e?`https://massagebackend.webenia.org/public/storage/${e}`:Y,ee=e=>{e.target.src=Y},B=e=>{A.value=e,D(()=>{const t=document.querySelector(".main-image");t&&(t.src=V(e))})},H=async()=>{var e;try{const t=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},o=await X.get(`https://massagebackend.webenia.org/api/website/show/products/${Z.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:t.code}});o.data.status&&(s.value=o.data.data,s.value._original_price=s.value.converted_price,(e=s.value.images)!=null&&e.length&&(A.value=s.value.images[0].path,D(()=>{j(),G()})))}catch(t){console.error("Error fetching product:",t)}},te=async e=>{var t,o,n;try{let v=0;if(e.discount&&e.discount.is_active){const m=parseFloat(e.discount.discount_value),z=parseFloat(e.price);v=z-z*(m/100)}else v=parseFloat(e.price);const u={product_id:e.id,quantity:1,price:v},w=(t=JSON.parse(localStorage.getItem("auth_user")))==null?void 0:t.id;w&&(u.user_id=w),e.amounts&&(u.amount_id=e.amount_id);const a=await X.post("https://massagebackend.webenia.org/api/cart-items",u,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.message&&(g({title:d("success"),message:a.data.message,type:"success"}),N.incrementCount(),await N.fetchCartCount())}catch(v){console.error("Error adding child product to cart:",v),g({title:"❌",message:((n=(o=v.response)==null?void 0:o.data)==null?void 0:n.message)||d("add_to_cart_error")||"Login required to add to cart",type:"error"})}},L=k(null),J=(e,t)=>{L.value=e,s.value.amount_id=t.id,s.value.price=t.price,t.converted_price!==void 0?s.value.converted_price=t.converted_price:s.value.converted_price=t.price},j=()=>{var n;const e=b(I.value),t=b(q.value);e.hasClass("slick-initialized")&&e.slick("unslick"),t.hasClass("slick-initialized")&&t.slick("unslick");const o=((n=s.value.images)==null?void 0:n.length)||0;Q.value=o,R.value=o>=4?3:1,e.slick({dots:!1,centerMode:!0,centerPadding:"0px",slidesToShow:R.value,slidesToScroll:1,infinite:o>1,focusOnSelect:!0,rtl:F.value==="ar",asNavFor:t,afterChange:function(v){const u=s.value.images[v];u&&B(u.path)}}),t.slick({slidesToShow:1,slidesToScroll:1,infinite:o>1,fade:!0,arrows:!1,dots:!1,centerMode:!0,rtl:F.value==="ar",asNavFor:e,afterChange:function(v){const u=s.value.images[v];u&&B(u.path)}})},de=()=>{const e=b(I.value),t=b(q.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickPrev"),t.slick("slickPrev"),se())},ue=()=>{const e=b(I.value),t=b(q.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickNext"),t.slick("slickNext"),se())},se=()=>{const e=b(I.value);if(e.length&&e.hasClass("slick-initialized")){const o=e.find(".slick-current").find("img").attr("src").replace("https://massagebackend.webenia.org/public/storage/","");B(o)}};Fe(async()=>{var e,t;await H(),(t=(e=s.value)==null?void 0:e.amounts)!=null&&t.length&&J(0,s.value.amounts[0]),D(()=>{j(),G()}),window.addEventListener("currency-changed",H)}),Se(()=>Z.params.id,async e=>{var t,o;await H(),(o=(t=s.value)==null?void 0:t.amounts)!=null&&o.length&&J(0,s.value.amounts[0]),W(),D(()=>{j(),G()})}),$e(()=>{const e=b(q.value),t=b(I.value);e.hasClass("slick-initialized")&&e.slick("unslick"),t.hasClass("slick-initialized")&&t.slick("unslick")});const U=e=>y.isInFavorites(e.id),ve=async e=>{var t,o;try{if(U(e)){const n=y.favorites.find(v=>v.product_id===e.id);if(n){const v=n.favorite_id||n.id;await y.removeFromFavorites(v),g({title:d("success"),message:d("favorite_removed")||"Product removed from favorites",type:"success"})}}else{const n=await y.addToFavorites(e.id);n&&g({title:d("success"),message:n.message||d("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){console.error("Error toggling child favorites:",n),g({title:d("error"),message:((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||d("login_required_favorite")||"Login required to favorite product",type:"error"})}},_e=()=>{h.value<ne?h.value++:g({title:d("warning"),message:d("max_quantity_reached"),type:"warning"})},pe=()=>{h.value>ie?h.value--:g({title:d("warning"),message:d("min_quantity_reached"),type:"warning"})},G=()=>{P(s.value.id)},me=e=>{if(e.discount&&e.discount.is_active){const t=parseFloat(e.discount.discount_value),o=parseFloat(e.converted_price);return(o-o*(t/100)).toFixed(2)}return e.converted_price},K=S(()=>p.value?p.value.converted_price!==void 0?p.value.converted_price:p.value.price:s.value.converted_price!==void 0?s.value.converted_price:s.value.price);S(()=>{if(s.value.discount&&s.value.discount.is_active){const e=parseFloat(s.value.discount.discount_value),t=parseFloat(K.value);return(t-t*(e/100)).toFixed(2)}return K.value});const p=S(()=>s.value.amounts&&s.value.amounts.length>0&&L.value!==null?s.value.amounts[L.value]:null),ge=S(()=>{var t;let e;if(e=p.value?parseFloat((t=p.value)==null?void 0:t.converted_price):parseFloat(s.value.converted_price),s.value.discount&&s.value.discount.is_active){const o=parseFloat(s.value.discount.discount_value);return e=e-e*(o/100),e.toFixed(2)}return e}),W=S(()=>F.value==="ar"?s.value.description_ar:s.value.description_en),ae=S(()=>{if(!W.value)return[];const e=W.value.split(`
`).filter(o=>o.trim()!=="");console.log("lines",e);const t=[];for(let o=0;o<e.length;o+=3)t.push(e.slice(o,o+3));return t});return(e,t)=>{const o=E("fa"),n=E("el-button"),v=E("el-col"),u=E("el-row"),w=E("router-link");return r(),c($,null,[_(xe),i("div",{class:"product-show",dir:O.value},[i("div",Pe,[_(u,{gutter:20,class:"product-container full-height-row flex-md-row flex-column-reverse"},{default:C(()=>[_(v,{xs:24,sm:24,md:12,lg:14},{default:C(()=>[i("div",Ee,[i("h1",Ne,l(M(F)==="ar"?s.value.name_ar:s.value.name_en),1),ae.value.length?(r(),c("ul",Ae,[(r(!0),c($,null,T(ae.value,(a,m)=>(r(),c("li",{key:m},[(r(!0),c($,null,T(a,(z,fe)=>(r(),c("p",{key:fe},l(z),1))),128))]))),128))])):f("",!0),i("div",Ve,[i("div",Be,[s.value.discount&&s.value.discount.is_active?(r(),c("span",Le,l(K.value)+" "+l(s.value.currency_code),1)):f("",!0),s.value.discount&&s.value.discount.is_active?(r(),c("span",Ue," -"+l(s.value.discount.discount_value)+"% ",1)):f("",!0)]),i("span",De,l(ge.value||0)+" "+l(s.value.currency_code),1),i("button",{onClick:t[0]||(t[0]=a=>ce(s.value)),class:x(["love-btn btn rounded-circle shadow-sm btn-light",P(s.value.id)?"text-danger":""]),title:P(s.value.id)?"Remove from favorites":"Add to favorites"},[_(o,{icon:P(s.value.id)?"fas fa-heart":"far fa-heart",size:"xl"},null,8,["icon"])],10,Me)]),i("div",Oe,[s.value.is_available?f("",!0):(r(),c("div",Re,l(e.$t("products.outOfStock")),1))]),s.value.amounts&&s.value.amounts.length>0?(r(),c("div",Qe,[i("h1",He,l(e.$t("amount.weight")),1),i("div",Je,[i("div",je,[(r(!0),c($,null,T(s.value.amounts,(a,m)=>(r(),c("div",{key:a.id,class:x(["weight-item p-0",{active:L.value===m}]),onClick:z=>J(m,a)},[i("p",null,l(O.value==="rtl"?a.weight+""+a.unit.name_en:a.weight+" "+a.unit.name_en)+" For "+l(a.converted_price)+" "+l(s.value.currency_code),1)],10,Ge))),128))])]),p.value?(r(),c("div",Ke,[i("p",null,[i("strong",null,l(e.$t("amount.selected"))+":",1),oe(" "+l(O.value==="rtl"?p.value.weight+""+p.value.unit.name_en:p.value.weight+" "+p.value.unit.name_en)+" - "+l(p.value.converted_price)+" "+l(s.value.currency_code),1)])])):(r(),c("div",We,[i("p",null,l(e.$t("amount.noAmount")),1)]))])):f("",!0),i("div",Xe,[_(n,{class:"add-to-cart btn",disabled:!s.value.is_available,type:"primary",size:"large",round:"",onClick:le},{default:C(()=>[oe(l(e.$t("products.addToCart")),1)]),_:1},8,["disabled"]),s.value.is_available?(r(),c("div",Ye,[i("div",Ze,[_(n,{size:"small",onClick:pe,disabled:h.value<=ie,class:"qty-btn"},{default:C(()=>[_(o,{icon:"minus"})]),_:1},8,["disabled"]),Ie(i("input",{dir:"ltr",class:"form-control qty-number",type:"number",min:"1",max:"99","onUpdate:modelValue":t[1]||(t[1]=a=>h.value=a),onInput:t[2]||(t[2]=a=>h.value=Math.min(h.value))},null,544),[[ze,h.value,void 0,{number:!0}]]),_(n,{size:"small",onClick:_e,disabled:h.value>=ne,class:"qty-btn"},{default:C(()=>[_(o,{icon:"plus"})]),_:1},8,["disabled"])])])):f("",!0)])])]),_:1}),_(v,{xs:24,sm:24,md:12,lg:10,class:"image-col"},{default:C(()=>[i("div",{class:"image-wrapper",ref_key:"main",ref:q},[(r(!0),c($,null,T(s.value.images,(a,m)=>(r(),c("div",{key:a.id,class:"slide"},[i("img",{src:V(A.value),class:"main-image",onError:ee},null,40,et)]))),128))],512),i("div",tt,[Q.value>1?(r(),c("button",{key:0,class:"btn nav-button left",onClick:de},[_(o,{icon:"arrow-left"})])):f("",!0),i("div",{class:x(["slider-container",{"centered-slides":R.value<3}])},[i("div",{class:"slider",ref_key:"slider",ref:I},[(r(!0),c($,null,T(s.value.images,(a,m)=>(r(),c("div",{key:a.id,class:"slide",onClick:z=>B(a.path)},[i("img",{src:V(a.path),class:x({active:A.value===a.path}),onError:ee},null,42,at)],8,st))),128))],512)],2),Q.value>1?(r(),c("button",{key:1,class:"btn nav-button right",onClick:ue},[_(o,{icon:"arrow-right"})])):f("",!0)])]),_:1})]),_:1}),s.value.children&&s.value.children.length>0?(r(),c("div",ot,[i("div",it,[_(o,{class:"fa-icon me-2",icon:["fas","shopping-basket"]}),i("h2",nt,l(M(d)("products.relatedProducts")),1)]),i("div",rt,[(r(!0),c($,null,T(s.value.children,a=>(r(),c("div",{class:"col-6 col-md-4 col-lg-3",key:a.id},[i("div",ct,[i("div",lt,[_(w,{to:`/read/products/${a.id}`},{default:C(()=>{var m;return[i("img",{src:(m=a.images)!=null&&m.length?V(a.images[0].path):Y,alt:M(F)==="ar"?a.name_ar:a.name_en,class:"card-img-top product-img"},null,8,dt)]}),_:2},1032,["to"]),a.is_available?f("",!0):(r(),c("div",ut,l(e.$t("products.outOfStock")),1)),i("div",vt,[_(w,{to:`/read/products/${a.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:C(()=>[_(o,{icon:"eye"})]),_:2},1032,["to"]),i("button",{onClick:m=>te(a),class:x(["btn btn-light shadow-sm disable",{disabled:!a.is_available}]),disabled:!a.is_available},l(e.$t("home.add-to-cart")),11,_t),i("button",{onClick:m=>te(a),class:x(["d-none btn rounded-circle btn-light shadow-sm enable",{disabled:!a.is_available}]),disabled:!a.is_available},[_(o,{icon:"cart-plus"})],10,pt),i("button",{onClick:m=>ve(a),class:x(["btn rounded-circle shadow-sm btn-light",U(a)?"text-danger":""]),title:U(a)?"Remove from favorites":"Add to favorites"},[_(o,{icon:U(a)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,mt)])]),i("div",gt,[i("h5",ft,l(M(F)==="ar"?a.name_ar:a.name_en),1),i("div",ht,[a.discount&&a.discount.is_active?(r(),c("span",kt," -"+l(a.discount.discount_value)+"% ",1)):f("",!0),a.discount&&a.discount.is_active?(r(),c("span",yt,l(a.converted_price||a.price)+" "+l(a.currency_code||"UAE"),1)):f("",!0),i("span",bt,l(me(a))+" "+l(a.currency_code||"UAE"),1)])])])]))),128))])])):f("",!0)])],8,qe),_(Te)],64)}}},$t=he(wt,[["__scopeId","data-v-842622d9"]]);export{$t as default};
